<link rel="icon" type="image/png" href="favicon.png">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alexkiu FISH | Configurador Pro</title>
    <style>
        :root {
            /* Paleta */
            --bg-deep: #020b14;
            --bg-panel: #0b1628;
            --neon-cyan: #00FFFF;
            --neon-blue: #2979ff;
            --neon-green: #00ff9d;
            --neon-red: #ff0055;
            --whatsapp-green: #25D366;
            --text-main: #e0f7fa;
            
            /* Variables Geometr√≠a */
            --tank-l: 300px; --tank-h: 200px; --tank-w: 150px;
            --wood-h: 25px; --glass-lid-h: 4px;
            
            /* NUEVO: Variable para el grosor del Tecnopor */
            --tecnopor-h: 20px; 
            
            /* Materiales */
            --glass-border: rgba(0, 255, 255, 0.3);
            --glass-bg: rgba(200, 255, 255, 0.02);
            --water-color: rgba(0, 255, 255, 0.08);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            display: flex; flex-direction: column; min-height: 100vh;
        }

        .bg-animation {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 50% 0%, #0f2540 0%, #020b14 80%);
        }

        /* --- HEADER --- */
        header { 
            padding: 3rem 1rem 1rem 1rem; 
            text-align: center; 
            border-bottom: 1px solid rgba(0,255,255,0.1); 
            position: relative; 
            overflow: hidden; 
            cursor: pointer; 
        }
        
        #headerBgFish {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; overflow: hidden;
        }

        .bg-fish-tiny {
            position: absolute; width: 8px; height: 4px; 
            border-radius: 50%; opacity: 0.5;
            box-shadow: 0 0 4px currentColor;
        }

        .title-container {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; position: relative; perspective: 500px; z-index: 10;
            margin-bottom: 1.5rem;
        }

        h1 { 
            font-weight: 900; font-size: clamp(3.5rem, 10vw, 6rem); 
            line-height: 1; margin: 0; font-style: italic; text-transform: uppercase;
            background-image: linear-gradient(to bottom, #ffffff 30%, var(--neon-cyan) 100%);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            text-shadow: 0 0 40px rgba(0, 255, 255, 0.3);
            position: relative; z-index: 2;
            transition: transform 0.2s;
        }

        h1.bite-active { animation: text-pulse-red 0.5s ease-out; }
        @keyframes text-pulse-red {
            0% { text-shadow: 0 0 40px rgba(0,255,255,0.3); }
            50% { transform: scale(1.05); text-shadow: 0 0 80px var(--neon-red), 0 0 30px var(--neon-red); }
            100% { transform: scale(1); text-shadow: 0 0 40px rgba(0,255,255,0.3); }
        }

        h2 {
            font-weight: 300; font-size: clamp(1.5rem, 5vw, 3rem);
            letter-spacing: 10px; margin: 5px 0 0 0; color: #fff;
            text-transform: uppercase; text-shadow: 0 0 15px var(--neon-blue); z-index: 2;
        }

        .intro-container {
            position: relative; z-index: 5;
            max-width: 800px; margin: 0 auto; padding: 0 1rem;
        }
        .intro-container p {
            font-size: 1.1rem; color: #e0f7fa; line-height: 1.6; margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8); font-weight: 300;
        }
        .intro-highlight { color: var(--neon-cyan); font-weight: bold; text-shadow: 0 0 10px rgba(0, 255, 255, 0.4); }

        .ripple {
            position: absolute; border-radius: 50%; background: rgba(0, 255, 255, 0.4);
            transform: scale(0); animation: ripple-anim 0.8s linear; pointer-events: none;
        }
        @keyframes ripple-anim { to { transform: scale(4); opacity: 0; } }

        .header-fish {
            position: absolute; width: 20px; height: 10px; background: transparent; border: 2px solid;
            border-radius: 40% 50% 50% 40%; z-index: 1; pointer-events: none; box-shadow: 0 0 15px currentColor;
        }
        .header-fish::after { 
            content: ''; position: absolute; right: -8px; top: -1px; width: 0; height: 0;
            border-top: 6px solid transparent; border-bottom: 6px solid transparent;
            border-right: 8px solid; border-left: 0; transform: scaleX(0.8); border-right-color: inherit;
        }

        @keyframes swim-chaotic {
            0% { left: -10%; top: var(--start-y); opacity: 0; transform: rotate(0deg); }
            10% { opacity: 1; }
            50% { top: var(--mid-y); }
            90% { opacity: 1; }
            100% { left: 110%; top: var(--end-y); opacity: 0; transform: rotate(0deg); }
        }
        @keyframes swim-bite-center { 
            0% { left: -10%; top: 20%; opacity: 0; transform: rotate(15deg); } 
            40% { left: 45%; top: 50%; transform: rotate(0deg) scale(1.2); opacity: 1; } 
            45% { left: 50%; top: 50%; transform: rotate(-10deg) scale(1); } 
            100% { left: 110%; top: 80%; opacity: 0; transform: rotate(-15deg); } 
        }

        /* --- LAYOUT PRINCIPAL --- */
        main {
            flex: 1; display: grid; grid-template-columns: 480px 1fr; gap: 2rem;
            padding: 2rem 3rem; max-width: 1900px; margin: 0 auto; width: 100%; align-items: start;
        }

        @media (max-width: 1000px) {
            main { display: flex; flex-direction: column; padding: 0; gap: 0; }
            .viewer-container { order: -1; height: 45vh !important; width: 100%; border-radius: 0 0 20px 20px; margin-bottom: 1rem; }
            .panel { width: 100%; border-radius: 20px 20px 0 0; padding: 1.5rem !important; border: none; border-top: 1px solid rgba(255,255,255,0.1); }
            header { padding: 1.5rem 0.5rem; }
            .intro-container p { font-size: 0.9rem; }
        }

        /* CONTROLES */
        .panel {
            background: var(--bg-panel); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 16px; padding: 2rem; box-shadow: 0 0 30px rgba(0,0,0,0.5); z-index: 5;
        }

        .panel-header {
            background: linear-gradient(135deg, #0f2035, #000);
            border: 2px solid var(--neon-blue); border-radius: 12px;
            padding: 12px; text-align: center; color: #fff; font-weight: 800;
            letter-spacing: 2px; text-transform: uppercase; margin-bottom: 1.5rem;
            box-shadow: 0 0 15px rgba(41, 121, 255, 0.2); font-size: 1rem;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        h3 { color: var(--neon-cyan); margin: 1.5rem 0 0.8rem 0; font-size: 1rem; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem; letter-spacing: 1px; }
        
        .input-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 5px; }
        
        input[type="number"] {
            width: 100%; background: #020617; border: 1px solid #1e293b; color: #fff;
            padding: 12px; border-radius: 8px; font-family: monospace; font-size: 1.1rem;
            color: var(--neon-cyan); outline: none; transition: 0.3s;
        }
        input[type="number"]:focus { border-color: var(--neon-cyan); box-shadow: 0 0 15px rgba(0,255,255,0.2); }

        /* ANALISIS T√âCNICO */
        .analysis-section { margin-bottom: 3rem; display: flex; flex-direction: column; gap: 1rem; }
        
        .volume-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px; padding: 10px;
            text-align: center; border: 1px solid rgba(0, 255, 255, 0.1);
        }
        .liters-display { font-size: 3rem; font-weight: 900; color: #fff; text-shadow: 0 0 10px var(--neon-cyan); line-height: 1; }
        .liters-unit { color: var(--neon-cyan); font-size: 0.8rem; letter-spacing: 2px; display: block; margin-top: 5px;}

        .filter-recommendation-box { margin-top: 1.5rem; padding-top: 1rem; border-top: 1px dashed rgba(255,255,255,0.1); }
        .filter-label { font-size: 0.75rem; color: var(--neon-green); text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 10px; }
        
        /* TARJETA DE FILTRO DISE√ëO FINAL */
        .filter-card-modern {
            background: linear-gradient(145deg, #050f1e, #020617);
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.1);
            border-radius: 12px; overflow: hidden;
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px; position: relative;
        }
        .filter-card-modern::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--neon-green);
        }

        .f-content { display: flex; align-items: center; gap: 15px; flex: 1; }
        .f-icon { font-size: 2.2rem; filter: drop-shadow(0 0 5px var(--neon-cyan)); }
        .f-details h4 { margin: 0; color: #fff; font-size: 1.1rem; font-weight: 600; line-height: 1.2; }
        .f-details p { margin: 3px 0 0; font-size: 0.8rem; color: #94a3b8; }
        .f-badge { font-size: 0.6rem; color: var(--neon-green); font-weight: bold; letter-spacing: 1px; margin-bottom: 2px; display: block;}

        /* Secci√≥n Derecha (Precio y Bot√≥n) */
        .f-action-area {
            display: flex; flex-direction: column; align-items: flex-end; gap: 8px;
            padding-left: 15px; border-left: 1px solid rgba(255,255,255,0.1);
            min-width: 120px;
        }
        .f-price-tag {
            font-size: 1.2rem; font-weight: 800; color: var(--neon-green);
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.3);
        }
        
        .btn-filter-action {
            background: transparent; border: 1px solid var(--neon-green); color: var(--neon-green);
            padding: 6px 12px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;
            cursor: pointer; text-transform: uppercase; transition: all 0.3s; width: 100%; letter-spacing: 1px;
            text-align: center;
        }
        .btn-filter-action:hover { background: rgba(0, 255, 157, 0.1); }
        .btn-filter-action.active {
            background: var(--neon-green); color: #000; box-shadow: 0 0 15px var(--neon-green);
        }

        /* BOTONES LLAMATIVOS */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 1.5rem; }
        .options-grid.three-cols { grid-template-columns: 1fr 1fr 1fr; }

        .opt-btn {
            background: linear-gradient(145deg, #0f2035, #0b1628); 
            border: 1px solid #334155; color: #94a3b8;
            padding: 15px 5px; border-radius: 12px; cursor: pointer;
            font-size: 0.95rem; transition: all 0.3s ease;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        }
        .opt-btn small { font-size: 0.7rem; margin-top: 4px; color: var(--neon-green); font-weight: bold; }
        .opt-btn:hover { border-color: var(--neon-blue); color: #fff; transform: translateY(-2px); }
        .opt-btn.active {
            background: linear-gradient(145deg, rgba(0, 255, 255, 0.15), rgba(0, 20, 40, 0.8));
            border: 2px solid var(--neon-cyan); color: #fff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3), inset 0 0 10px rgba(0,255,255,0.1);
            font-weight: bold; transform: scale(1.05);
        }

        /* RESUMEN */
        .summary-box { margin-top: 2rem; background: rgba(0, 0, 0, 0.6); border: 1px solid var(--neon-green); border-radius: 12px; padding: 1.5rem; }
        .summary-header { color: var(--neon-green); text-transform: uppercase; font-size: 1rem; border-bottom: 1px dashed rgba(255,255,255,0.2); padding-bottom: 10px; margin-bottom: 10px; }
        .summary-item { display: flex; justify-content: space-between; font-size: 0.95rem; margin-bottom: 8px; color: #ccc; border-bottom: 1px dashed rgba(255,255,255,0.1); padding-bottom: 4px; }
        .summary-total { display: flex; justify-content: space-between; margin-top: 15px; border-top: 1px solid var(--neon-green); padding-top: 10px; font-size: 1.5rem; color: var(--neon-green); font-weight: bold; }
        .remove-item { color: #ff4444; cursor: pointer; font-weight:bold; margin-left:5px;}

        .btn-whatsapp {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; margin-top: 20px; padding: 15px;
            background: var(--whatsapp-green); color: #fff; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: bold; text-transform: uppercase;
            cursor: pointer; transition: 0.3s; box-shadow: 0 0 20px rgba(37, 211, 102, 0.2);
        }
        .btn-whatsapp:hover { background: #1ebe57; transform: scale(1.02); box-shadow: 0 0 30px rgba(37, 211, 102, 0.4); }

        /* --- VISUALIZADOR 3D --- */
        .viewer-container {
            position: relative; height: 750px;
            background: radial-gradient(circle, #132235 0%, transparent 70%);
            border-radius: 16px; overflow: hidden; cursor: grab;
            display: flex; align-items: center; justify-content: center;
            perspective: 2000px; touch-action: pan-y; z-index: 1;
        }
        .viewer-container:active { cursor: grabbing; }
        .instruction-overlay {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.3); font-size: 0.8rem; pointer-events: none; letter-spacing: 2px;
        }

        /* MANO */
        .hand-hint {
            position: absolute; bottom: 40px; width: 50px; height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"/><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/></svg>');
            background-size: contain; background-repeat: no-repeat;
            opacity: 0; animation: hand-swipe 3s ease-in-out infinite;
            pointer-events: none; filter: drop-shadow(0 0 5px cyan);
        }
        @keyframes hand-swipe { 0% { transform: translateX(-20px) rotate(-10deg); opacity: 0; } 20% { opacity: 0.8; } 80% { opacity: 0.8; } 100% { transform: translateX(20px) rotate(10deg); opacity: 0; } }

        /* ESCENA 3D */
        .scene { position: relative; width: 0; height: 0; transform-style: preserve-3d; transform: rotateX(-20deg) rotateY(35deg); transition: transform 0.05s linear; }
        .tank { transform-style: preserve-3d; position: absolute; }
        .face { position: absolute; background: var(--glass-bg); border: 1px solid var(--glass-border); box-shadow: 0 0 40px rgba(0,255,255,0.05) inset; backface-visibility: visible; transition: all 0.4s ease; }

        .f-front { width: var(--tank-l); height: var(--tank-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)); pointer-events: none; }
        .f-back  { width: var(--tank-l); height: var(--tank-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)); }
        .f-right { width: var(--tank-w); height: var(--tank-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)); }
        .f-left  { width: var(--tank-w); height: var(--tank-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)); }
        .f-top   { width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc(var(--tank-h) / 2)); }
        .f-bottom{ width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(-90deg) translateZ(calc(var(--tank-h) / 2)); background: rgba(0,0,0,0.95); border:1px solid #333; }

        .water { position: absolute; top: 0; left: 0; transform-style: preserve-3d; }
        .w-face { position: absolute; background: var(--water-color); border: none; pointer-events: none; }
        .w-front { width: calc(var(--tank-l) - 2px); height: calc(var(--tank-h) * 0.85); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2 - 1px)) translateY(calc(var(--tank-h) * 0.075)); }
        .w-back  { width: calc(var(--tank-l) - 2px); height: calc(var(--tank-h) * 0.85); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2 - 1px)) translateY(calc(var(--tank-h) * 0.075)); }
        .w-right { width: calc(var(--tank-w) - 2px); height: calc(var(--tank-h) * 0.85); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2 - 1px)) translateY(calc(var(--tank-h) * 0.075)); }
        .w-left  { width: calc(var(--tank-w) - 2px); height: calc(var(--tank-h) * 0.85); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2 - 1px)) translateY(calc(var(--tank-h) * 0.075)); }
        .w-top   { width: calc(var(--tank-l) - 2px); height: calc(var(--tank-w) - 2px); transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc((var(--tank-h) * 0.85) / 2 - (var(--tank-h) * 0.075))); background: rgba(0,255,255,0.25); box-shadow: 0 0 50px var(--neon-cyan); }

        .wood-texture { background-color: #4e342e; background-image: repeating-linear-gradient(45deg, rgba(255,255,255,0.03) 0px, rgba(255,255,255,0.03) 1px, transparent 1px, transparent 12px); border: 1px solid #3e2723; box-shadow: inset 0 0 10px rgba(0,0,0,0.5); }
        .wood-group { display: none; transform-style: preserve-3d; } .wood-group.visible { display: block; }
        .wood-face { position: absolute; transition: all 0.4s ease; }

        .wl-front { width: var(--tank-l); height: var(--wood-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--wood-h) / 2) * -1 )); }
        .wl-back  { width: var(--tank-l); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--wood-h) / 2) * -1 )); }
        .wl-right { width: var(--tank-w); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--wood-h) / 2) * -1 )); }
        .wl-left  { width: var(--tank-w); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--wood-h) / 2) * -1 )); }
        .wl-top   { width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc( var(--tank-h) / 2 + var(--wood-h) )); box-shadow: 0 0 20px rgba(0,0,0,0.5); }

        .wb-front { width: var(--tank-l); height: var(--wood-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)) translateY(calc( var(--tank-h) / 2 + var(--wood-h) / 2 )); }
        .wb-back  { width: var(--tank-l); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)) translateY(calc( var(--tank-h) / 2 + var(--wood-h) / 2 )); }
        .wb-right { width: var(--tank-w); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( var(--tank-h) / 2 + var(--wood-h) / 2 )); }
        .wb-left  { width: var(--tank-w); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( var(--tank-h) / 2 + var(--wood-h) / 2 )); }
        .wb-bottom{ width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(-90deg) translateZ(calc( var(--tank-h) / 2 + var(--wood-h) )); box-shadow: 0 10px 30px rgba(0,0,0,0.8); }
        
        /* BASE TECNOPOR OSCURA Y GRUESA */
        .tecnopor-face { 
            position: absolute; 
            /* Color NEGRO PROFUNDO */
            background-color: #080808; 
            background-image: radial-gradient(#1a1a1a 15%, transparent 16%), radial-gradient(#1a1a1a 15%, transparent 16%);
            background-size: 4px 4px; background-position: 0 0, 2px 2px;
            border: 1px solid #000; 
        }
        /* Ajuste de altura a variable --tecnopor-h (20px) y centrado */
        .wt-front { width: var(--tank-l); height: var(--tecnopor-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)) translateY(calc( var(--tank-h) / 2 + var(--tecnopor-h) / 2 )); }
        .wt-back  { width: var(--tank-l); height: var(--tecnopor-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)) translateY(calc( var(--tank-h) / 2 + var(--tecnopor-h) / 2 )); }
        .wt-right { width: var(--tank-w); height: var(--tecnopor-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( var(--tank-h) / 2 + var(--tecnopor-h) / 2 )); }
        .wt-left  { width: var(--tank-w); height: var(--tecnopor-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( var(--tank-h) / 2 + var(--tecnopor-h) / 2 )); }
        .wt-bottom{ width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(-90deg) translateZ(calc( var(--tank-h) / 2 + var(--tecnopor-h) )); }

        /* TAPA VIDRIO NEGRA (3PX) */
        .glass-group { display: none; transform-style: preserve-3d; } .glass-group.visible { display: block; }
        .glass-face { 
            position: absolute; background: rgba(10, 10, 10, 0.7); 
            border: 1px solid rgba(255,255,255,0.15); box-shadow: inset 0 0 5px rgba(255,255,255,0.05); 
            transition: all 0.4s ease; 
        }
        .gl-front { width: var(--tank-l); height: var(--glass-lid-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--glass-lid-h) / 2) * -1 )); }
        .gl-back  { width: var(--tank-l); height: var(--glass-lid-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--glass-lid-h) / 2) * -1 )); }
        .gl-right { width: var(--tank-w); height: var(--glass-lid-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--glass-lid-h) / 2) * -1 )); }
        .gl-left  { width: var(--tank-w); height: var(--glass-lid-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--glass-lid-h) / 2) * -1 )); }
        .gl-top   { width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc( var(--tank-h) / 2 + var(--glass-lid-h) )); background: rgba(5, 5, 5, 0.85); }

        .metal-mode .face { border: 8px solid #151515; box-shadow: 0 0 0 1px #333; }
        .tecnopor-group { display: none; transform-style: preserve-3d; } .tecnopor-group.visible { display: block; }

        /* --- PECES --- */
        .aquarium-content { position: absolute; top: 0; left: 0; width: 0; height: 0; transform-style: preserve-3d; pointer-events: none; }
        .fish-wrapper { position: absolute; transform-style: preserve-3d; animation: swim-path 20s linear infinite, float-y 4s ease-in-out infinite; }
        .fish-model { position: relative; transform-style: preserve-3d; }
        .fish-part { position: absolute; backface-visibility: visible; }

        .betta .body { width: 30px; height: 12px; background: var(--fish-color); border-radius: 10px; box-shadow: 0 0 8px var(--fish-color); }
        .betta .tail { width: 45px; height: 35px; background: linear-gradient(90deg, var(--fish-color), transparent); top: -10px; left: -38px; border-radius: 50% 0 0 50%; opacity: 0.9; transform-origin: right center; animation: tail-wag 0.8s ease-in-out infinite alternate; }
        .betta .fin { width: 15px; height: 10px; background: var(--fish-color); top: 8px; left: 5px; transform: rotateX(45deg); opacity: 0.7; }

        .gold .body { width: 34px; height: 24px; background: var(--fish-body-grad); border-radius: 50% 50% 40% 40%; box-shadow: inset -2px -2px 6px rgba(0,0,0,0.2); }
        .gold .tail { width: 28px; height: 32px; background: radial-gradient(circle at right, var(--fish-tail-color), transparent); position: absolute; top: -4px; left: -20px; border-radius: 50% 0 0 50%; opacity: 0.9; transform-origin: right center; animation: tail-wag 0.5s ease-in-out infinite alternate; }
        .gold .dorsal { width: 16px; height: 10px; background: var(--fish-tail-color); position: absolute; top: -8px; left: 10px; border-radius: 50% 50% 0 0; opacity: 0.8; transform: translateZ(0); }
        .gold .pectoral { width: 10px; height: 6px; background: var(--fish-tail-color); position: absolute; top: 14px; left: 18px; opacity: 0.8; animation: fin-flutter 0.2s linear infinite alternate; }
        .gold .pectoral.left { transform: translateZ(2px) rotateY(45deg); }
        .gold .pectoral.right { transform: translateZ(-2px) rotateY(-45deg); }

        @keyframes swim-path {
            0%   { transform: translateX(calc(var(--tank-l) * -0.30)) translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(0deg); }
            49%  { transform: translateX(calc(var(--tank-l) * 0.30))  translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(0deg); }
            50%  { transform: translateX(calc(var(--tank-l) * 0.30))  translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(180deg); }
            99%  { transform: translateX(calc(var(--tank-l) * -0.30)) translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(180deg); }
            100% { transform: translateX(calc(var(--tank-l) * -0.30)) translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(0deg); }
        }
        @keyframes float-y { 0%, 100% { margin-top: -5px; } 50% { margin-top: 5px; } }
        @keyframes tail-wag { from { transform: rotateY(20deg); } to { transform: rotateY(-20deg); } }
        @keyframes fin-flutter { from { transform: translateZ(2px) rotateY(30deg); } to { transform: translateZ(2px) rotateY(60deg); } }

        /* FOOTER TIENDA DIGITAL */
        .shop-wrapper { width: 100%; margin-top: auto; background: #050f1e; border-top: 1px solid rgba(0,255,255,0.1); }
        .shop-toggle-btn {
            width: 100%; background: #050f1e; color: var(--neon-cyan); border: none; padding: 1.5rem 2rem;
            font-size: 1.2rem; font-weight: bold; letter-spacing: 2px; text-transform: uppercase;
            cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            transition: background 0.3s, color 0.3s;
        }
        .shop-toggle-btn:hover { background: #0b1628; color: #fff; text-shadow: 0 0 10px var(--neon-cyan); }
        .shop-content { max-height: 0; overflow: hidden; opacity: 0; transition: max-height 0.6s ease-in-out, opacity 0.4s ease; background: #020617; }
        .shop-content.open { max-height: 1200px; opacity: 1; }
        #arrowIcon { transition: transform 0.4s ease; font-size: 1.5rem; }

        .shop-tabs { display: flex; justify-content: center; gap: 10px; padding: 1rem; flex-wrap: wrap; }
        .tab-btn { background: transparent; border: 1px solid var(--neon-blue); color: #fff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: 0.3s; }
        .tab-btn.active, .tab-btn:hover { background: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); }

        .carousel-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1rem; padding: 2rem; }
        .product-card { background: #0f172a; border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 1rem; transition: 0.3s; display: flex; flex-direction: column; text-align: center; }
        .product-card:hover { border-color: var(--neon-cyan); transform: translateY(-5px); }
        
        /* ESTILO PARA IMAGENES DE PRODUCTO */
        .p-img { 
            width: 100%; height: 120px; 
            background: #020617; border-radius: 8px; 
            margin-bottom: 0.5rem; overflow: hidden; 
            display: flex; align-items: center; justify-content: center;
        }
        .p-img img {
            width: 100%; height: 100%; object-fit: cover;
        }

        .p-name { font-size: 0.9rem; margin-bottom: 0.5rem; color: #fff; }
        .p-price { color: var(--neon-green); font-weight: bold; font-size: 1rem; margin-bottom: 0.5rem; }
        .p-btn { width: 100%; padding: 8px; background: transparent; border: 1px solid var(--neon-cyan); color: var(--neon-cyan); cursor: pointer; border-radius: 4px; transition: 0.3s; }
        .p-btn:hover { background: var(--neon-cyan); color: #000; }

    </style>
</head>
<body>

    <div class="bg-animation"></div>

    <header id="mainHeader">
        <div id="headerBgFish"></div>
        <div class="title-container">
            <h1>Alexkiu</h1>
            <h2>FISH</h2>
            <div id="headerFishContainer"></div>
        </div>
        <div class="intro-container">
            <p>La primera experiencia inmersiva para dise√±ar tu ecosistema. Personaliza dimensiones, acabados y equipamiento con nuestra tecnolog√≠a de modelado <span class="intro-highlight">3D en tiempo real</span>.</p>
        </div>
    </header>

    <main>
        <!-- PANEL IZQUIERDO -->
        <section class="panel controls">
            <div class="panel-header">üìä AN√ÅLISIS T√âCNICO</div>
            
            <div class="analysis-section">
                <div class="volume-card">
                    <div class="liters-display" id="txtLiters">0</div>
                    <span class="liters-unit">LITROS</span>
                </div>

                <div class="filter-recommendation-box">
                    <span class="filter-label">Sistema de filtraci√≥n sugerido</span>
                    
                    <div class="filter-card-modern">
                        <div class="f-content">
                            <div class="f-icon" id="recIcon">‚öôÔ∏è</div>
                            <div class="f-details">
                                <span class="f-badge">RECOMENDADO POR IA</span>
                                <h4 id="recTitle">Analizando...</h4>
                                <p id="recDesc">Calculando...</p>
                            </div>
                        </div>
                        <div class="f-action-area">
                            <div class="f-price-tag" id="filterPriceDisplay">S/ 0.00</div>
                            <button id="btnFilterToggle" class="btn-filter-action active" onclick="toggleFilter()">INCLUIDO</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-header">üéõÔ∏è PERSONALIZACI√ìN</div>
            
            <h3>Dimensiones (cm)</h3>
            <div class="input-group">
                <label>Largo (Frontal)</label>
                <input type="number" id="inpL" value="120" min="30" max="300">
            </div>
            <div class="input-group">
                <label>Alto (Altura)</label>
                <input type="number" id="inpH" value="50" min="20" max="150">
            </div>
            <div class="input-group">
                <label>Fondo (Profundidad)</label>
                <input type="number" id="inpW" value="40" min="20" max="100">
            </div>

            <h3>Acabados</h3>
            <div class="options-grid" id="finish-options">
                <div class="opt-btn active" onclick="setFinish('rimless', this)">Sin Marco <small>S/ 0</small></div>
                <div class="opt-btn" onclick="setFinish('metal', this)">Aluminio <small>+S/ 50</small></div>
            </div>

            <h3>Tapa Superior</h3>
            <div class="options-grid three-cols" id="lid-options">
                <div class="opt-btn active" onclick="setLid('none', this)">Sin Tapa <small>S/ 0</small></div>
                <div class="opt-btn" onclick="setLid('glass', this)">Vidrio <small>+S/ 10</small></div>
                <div class="opt-btn" onclick="setLid('wood', this)">Madera <small>+S/ 100</small></div>
            </div>

            <h3>Modelo de Base</h3>
            <div class="options-grid three-cols" id="base-options">
                <div class="opt-btn" onclick="setBase('none', this)">No Incluir <small>S/ 0</small></div>
                <div class="opt-btn active" onclick="setBase('tecnopor', this)">Tecnopor <small>S/ 0</small></div>
                <div class="opt-btn" onclick="setBase('wood', this)">Madera <small>+S/ 150</small></div>
            </div>

            <div class="summary-box">
                <div class="summary-header">Detalle de Cotizaci√≥n</div>
                <div id="orderList"></div>
                <div class="summary-total">
                    <span>TOTAL:</span>
                    <span id="totalPrice">S/ 0.00</span>
                </div>
                <button class="btn-whatsapp" onclick="sendToWhatsapp()">
                    <span>Cot√≠zalo aqu√≠ üì≤</span>
                </button>
            </div>
        </section>

        <!-- VISUALIZADOR 3D -->
        <section class="viewer-container" id="viewer">
            <div class="instruction-overlay"></div>
            <div class="hand-hint" style="position: absolute; bottom: 20px; width: 40px; height: 40px; background: url('data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'white\'><path d=\'M21.36 9.5a2.5 2.5 0 0 0-4.24-1.78l-.52-.52a2.5 2.5 0 0 0-3.54 0 2.5 2.5 0 0 0 0 3.54l.52.52-.52-.52a2.5 2.5 0 0 0-3.54 0 2.5 2.5 0 0 0 0 3.54l.52.52-6.36-6.36a2.5 2.5 0 1 1 3.54-3.54l6.36 6.36.52-.52a2.5 2.5 0 0 1 3.54 0 2.5 2.5 0 0 1 0 3.54l-5.66 5.66 1.42 1.42 5.66-5.66a2.5 2.5 0 0 1 0-3.54zm-10.61 0l-1.42-1.42a.5.5 0 0 1 .71-.71l1.42 1.42-.71.71z\'/></svg>') no-repeat center center; background-size: contain; opacity: 0.6; animation: hand-swipe 2s infinite; pointer-events: none; filter: drop-shadow(0 0 5px cyan);"></div>
            <div class="scene" id="scene">
                <div class="tank" id="tank">
                    <div class="face f-front"></div>
                    <div class="face f-back"></div>
                    <div class="face f-right"></div>
                    <div class="face f-left"></div>
                    <div class="face f-bottom"></div>
                    
                    <div class="wood-group" id="woodLidGroup"><div class="wood-face wood-texture wl-front"></div><div class="wood-face wood-texture wl-back"></div><div class="wood-face wood-texture wl-right"></div><div class="wood-face wood-texture wl-left"></div><div class="wood-face wood-texture wl-top"></div></div>
                    <div class="glass-group" id="glassLidGroup"><div class="glass-face gl-front"></div><div class="glass-face gl-back"></div><div class="glass-face gl-right"></div><div class="glass-face gl-left"></div><div class="glass-face gl-top"></div></div>
                    
                    <div class="wood-group" id="woodBaseGroup"><div class="wood-face wood-texture wb-front"></div><div class="wood-face wood-texture wb-back"></div><div class="wood-face wood-texture wb-right"></div><div class="wood-face wood-texture wb-left"></div><div class="wood-face wood-texture wb-bottom"></div></div>
                    <div class="tecnopor-group" id="tecnoporBaseGroup"><div class="tecnopor-face wt-front"></div><div class="tecnopor-face wt-back"></div><div class="tecnopor-face wt-right"></div><div class="tecnopor-face wt-left"></div><div class="tecnopor-face wt-bottom"></div></div>

                    <div class="aquarium-content" id="lifeContainer"></div>
                    <div class="water"><div class="w-face w-front"></div><div class="w-face w-back"></div><div class="w-face w-right"></div><div class="w-face w-left"></div><div class="w-face w-top"></div></div>
                </div>
            </div>
        </section>
    </main>

    <!-- TIENDA DIGITAL -->
    <section class="shop-wrapper">
        <button id="shopToggle" class="shop-toggle-btn">
            <span>üõí TIENDA DIGITAL</span>
            <span id="arrowIcon">‚ñº</span>
        </button>
        <div id="shopContent" class="shop-content">
            <div class="shop-tabs">
                <button class="tab-btn active" onclick="loadCategory('food', this)">Alimentos</button>
                <button class="tab-btn" onclick="loadCategory('filters', this)">Filtros</button>
                <button class="tab-btn" onclick="loadCategory('decor', this)">Decoraci√≥n</button>
                <button class="tab-btn" onclick="loadCategory('substrates', this)">Sustratos</button>
            </div>
            <div class="carousel-container" id="shopCarousel"></div>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let currentScale = 6;
            let currentFinish = 'rimless';
            let currentLid = 'none';
            let currentBase = 'tecnopor'; 
            let cart = [];
            let currentTotal = 0;
            let isFilterIncluded = true;

            // DOM Elements
            const root = document.documentElement;
            const inpL = document.getElementById('inpL'), inpH = document.getElementById('inpH'), inpW = document.getElementById('inpW');
            const txtLiters = document.getElementById('txtLiters');
            const tankEl = document.getElementById('tank');
            const woodLidGroup = document.getElementById('woodLidGroup'), glassLidGroup = document.getElementById('glassLidGroup');
            const woodBaseGroup = document.getElementById('woodBaseGroup'), tecnoporBaseGroup = document.getElementById('tecnoporBaseGroup');
            const filterPriceDisplay = document.getElementById('filterPriceDisplay');
            const btnFilterToggle = document.getElementById('btnFilterToggle');
            const recIcon = document.getElementById('recIcon'), recTitle = document.getElementById('recTitle'), recDesc = document.getElementById('recDesc');
            const orderList = document.getElementById('orderList'), totalPriceEl = document.getElementById('totalPrice');
            const lifeContainer = document.getElementById('lifeContainer');

            // Background Fish (Random)
            const bgContainer = document.getElementById('headerBgFish');
            const fishColors = ['#00FFFF', '#00ff9d', '#ff0055', '#bd00ff', '#ffeb3b'];
            for(let i=0; i<30; i++) {
                let f = document.createElement('div');
                f.className = 'bg-fish-tiny';
                f.style.color = fishColors[Math.floor(Math.random() * fishColors.length)];
                f.style.top = Math.random() * 100 + '%';
                f.style.left = Math.random() * 100 + '%';
                let anim = Math.random() > 0.5 ? 'swim-l-r' : 'swim-r-l';
                f.style.animation = `${anim} ${20 + Math.random() * 20}s linear ${Math.random() * -20}s infinite`;
                bgContainer.appendChild(f);
            }

            // Header Interactive Fish
            const headerFishContainer = document.getElementById('headerFishContainer');
            for(let i=0; i<6; i++) {
                let fish = document.createElement('div');
                fish.className = 'header-fish';
                fish.style.color = fishColors[i % fishColors.length];
                fish.style.borderColor = fish.style.color;
                fish.style.boxShadow = `0 0 10px ${fish.style.color}`;
                
                let animType = (i % 3 === 0) ? 'swim-bite-center' : 'swim-chaotic';
                fish.style.setProperty('--start-x', (Math.random() * 100) + '%');
                fish.style.setProperty('--mid-x', (Math.random() * 100) + '%');
                fish.style.setProperty('--end-x', (Math.random() * 100) + '%');

                if(animType === 'swim-bite-center') {
                    fish.addEventListener('animationiteration', () => {
                        if(Math.random() > 0.5) {
                            document.querySelector('h1').classList.add('bite-active');
                            setTimeout(() => document.querySelector('h1').classList.remove('bite-active'), 500);
                        }
                    });
                }
                fish.style.animation = `${animType} ${8 + Math.random() * 5}s linear ${Math.random() * -10}s infinite`;
                headerFishContainer.appendChild(fish);
            }

            // Ripple Effect
            document.getElementById('mainHeader').addEventListener('click', function(e) {
                let ripple = document.createElement('div');
                ripple.className = 'ripple';
                let rect = this.getBoundingClientRect();
                ripple.style.left = (e.clientX - rect.left - 50) + 'px';
                ripple.style.top = (e.clientY - rect.top - 50) + 'px';
                this.appendChild(ripple);
                setTimeout(() => ripple.remove(), 800);
            });

            // Global Functions
            window.setFinish = function(val, btn) {
                document.querySelectorAll('#finish-options .opt-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFinish = val; updateTank();
            }
            window.setLid = function(val, btn) {
                document.querySelectorAll('#lid-options .opt-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentLid = val; updateTank();
            }
            window.setBase = function(val, btn) {
                document.querySelectorAll('#base-options .opt-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentBase = val; updateTank();
            }
            
            // Toggle Filter Logic
            window.toggleFilter = function() {
                isFilterIncluded = !isFilterIncluded;
                const btn = document.getElementById('btnFilterToggle');
                if(isFilterIncluded) {
                    btn.classList.add('active');
                    btn.innerText = "INCLUIDO";
                } else {
                    btn.classList.remove('active');
                    btn.innerText = "AGREGAR";
                }
                updateTank();
            }

            window.addToCart = function(n, p) { 
                cart.push({name:n, price:p}); updateTank(); 
            };
            window.removeFromCart = function(i) { 
                cart.splice(i, 1); updateTank(); 
            };

            window.updateTank = function() {
                let l = parseFloat(inpL.value) || 30;
                let h = parseFloat(inpH.value) || 30;
                let w = parseFloat(inpW.value) || 30;
                let volume = (l * h * w) / 1000;
                txtLiters.innerText = Math.round(volume);

                root.style.setProperty('--tank-l', (l * currentScale) + 'px');
                root.style.setProperty('--tank-h', (h * currentScale) + 'px');
                root.style.setProperty('--tank-w', (w * currentScale) + 'px');

                let filterData = getFilterData(volume);
                recIcon.innerText = filterData.icon;
                recTitle.innerText = filterData.name;
                recDesc.innerText = filterData.desc;
                filterPriceDisplay.innerText = "S/ " + filterData.price.toFixed(2);

                woodLidGroup.classList.remove('visible');
                glassLidGroup.classList.remove('visible');
                woodBaseGroup.classList.remove('visible');
                tecnoporBaseGroup.classList.remove('visible');

                if(currentLid === 'wood') woodLidGroup.classList.add('visible');
                if(currentLid === 'glass') glassLidGroup.classList.add('visible');
                if(currentBase === 'wood') woodBaseGroup.classList.add('visible');
                if(currentBase === 'tecnopor') tecnoporBaseGroup.classList.add('visible');

                tankEl.classList.toggle('metal-mode', currentFinish === 'metal');

                calculateQuote(volume, filterData);
                generateLife(volume);
            };

            function getFilterData(vol) {
                if (vol < 40) return { name: "Filtro Cascada Mini", price: 45, icon: "üíß", desc: "Para nano acuarios" };
                if (vol < 100) return { name: "Filtro Cascada", price: 85, icon: "üîã", desc: "Filtraci√≥n media" };
                if (vol < 250) return { name: "Canister Externo", price: 380, icon: "üõ¢Ô∏è", desc: "Agua cristalina" };
                return { name: "Sump Profesional", price: 650, icon: "üè≠", desc: "Filtraci√≥n industrial" };
            }

            function calculateQuote(liters, filterData) {
                let basePrice = 0;
                if (liters <= 30) basePrice = 50;
                else if (liters <= 50) basePrice = 70;
                else if (liters <= 80) basePrice = 100;
                else if (liters <= 100) basePrice = 200;
                else if (liters <= 120) basePrice = 220;
                else if (liters <= 150) basePrice = 250;
                else if (liters <= 200) basePrice = 300;
                else basePrice = 300 + ((liters - 200) * 2);

                let finishPrice = (currentFinish === 'metal') ? 50 : 0;
                let finishName = (currentFinish === 'metal') ? 'Marco Aluminio ' : 'Sin Marco';
                
                let lidPrice = 0;
                let lidName = 'Sin Tapa';
                if (currentLid === 'wood') { lidPrice = 100; lidName = 'Tapa Madera 3D'; }
                if (currentLid === 'glass') { lidPrice = 10; lidName = 'Tapa Vidrio '; }

                let baseCost = 0;
                let baseName = 'Sin Base';
                if(currentBase === 'wood') { baseName = 'Base Madera'; baseCost = 150; }
                if(currentBase === 'tecnopor') { baseName = 'Base Tecnopor'; baseCost = 0; }

                let filterCost = isFilterIncluded ? filterData.price : 0;

                let html = `
                    <div class="summary-item"><span>Pecera Base (${Math.round(liters)}L)</span><span>S/ ${basePrice.toFixed(2)}</span></div>
                    <div class="summary-item"><span>${finishName}</span><span>S/ ${finishPrice.toFixed(2)}</span></div>
                `;
                if(currentLid !== 'none') html += `<div class="summary-item"><span>${lidName}</span><span>S/ ${lidPrice.toFixed(2)}</span></div>`;
                if(currentBase !== 'none') html += `<div class="summary-item"><span>${baseName}</span><span>S/ ${baseCost.toFixed(2)}</span></div>`;
                if(isFilterIncluded) html += `<div class="summary-item" style="color:var(--neon-green);"><span>${filterData.name}</span><span>S/ ${filterCost.toFixed(2)}</span></div>`;

                let accTotal = 0;
                cart.forEach((item, idx) => {
                    accTotal += item.price;
                    html += `<div class="summary-item"><span>${item.name} <small class="remove-item" onclick="removeFromCart(${idx})">[X]</small></span><span>S/ ${item.price.toFixed(2)}</span></div>`;
                });

                orderList.innerHTML = html;
                currentTotal = basePrice + finishPrice + lidPrice + baseCost + filterCost + accTotal;
                totalPriceEl.innerText = "S/ " + currentTotal.toFixed(2);
            }

            window.sendToWhatsapp = function() {
                let l = parseFloat(inpL.value);
                let h = parseFloat(inpH.value);
                let w = parseFloat(inpW.value);
                let liters = Math.round((l * h * w) / 1000);
                let basePrice = 0;
                if (liters <= 30) basePrice = 50; else if (liters <= 50) basePrice = 70; else if (liters <= 80) basePrice = 100; else if (liters <= 100) basePrice = 200; else if (liters <= 120) basePrice = 220; else if (liters <= 150) basePrice = 250; else if (liters <= 200) basePrice = 300; else basePrice = 300 + ((liters - 200) * 2);
                
                let finishName = (currentFinish === 'metal') ? 'Marco Aluminio ' : 'Sin Marco (Acabado Lujo)';
                let lidName = 'Sin Tapa'; if (currentLid === 'wood') lidName = 'Tapa de Madera 3D'; if (currentLid === 'glass') lidName = 'Tapa de Vidrio ';
                let baseName = 'Sin Base'; if(currentBase === 'wood') baseName = 'Base Madera'; if(currentBase === 'tecnopor') baseName = 'Base Tecnopor';
                let filterCost = isFilterIncluded ? parseInt(filterPriceDisplay.innerText.replace('S/ ','')) : 0;

                let msg = `*Hola Alexkiu FISH! Quiero hacer realidad este acuario:*\n\n`;
                msg += `*DETALLES DE LA COTIZACION:*\n\n`;
                msg += `*Medidas:* ${l}x${h}x${w} cm\n`;
                msg += `*Volumen:* ${liters} Litros (S/ ${basePrice.toFixed(2)})\n\n`;
                msg += `*Estilo:* ${finishName}\n`;
                msg += `*Tapa:* ${lidName}\n`;
                msg += `*Base:* ${baseName}\n`;
                if(isFilterIncluded) msg += `*Sistema:* ${recTitle.innerText} (+S/ ${filterCost.toFixed(2)})\n`;
                if(cart.length > 0) { msg += `\n*ACCESORIOS EXTRA:*\n`; cart.forEach(i => msg += `- ${i.name} (S/ ${i.price.toFixed(2)})\n`); }
                msg += `\n*INVERSION TOTAL:* S/ ${currentTotal.toFixed(2)}\n\n`;
                msg += `*Por favor, confirmenme disponibilidad.*`;
                window.open(`https://wa.me/51908761978?text=${encodeURIComponent(msg)}`, '_blank');
            };

            function generateLife(liters) {
                let targetCount;
                if(liters < 60) targetCount = Math.floor(Math.random() * 3) + 1; 
                else if(liters <= 150) targetCount = Math.floor(Math.random() * 3) + 3; 
                else targetCount = Math.floor(Math.random() * 3) + 5; 

                if (lifeContainer.childElementCount === targetCount) return;

                lifeContainer.innerHTML = '';
                const colorsBetta = ['#00FFFF', '#FF0000', '#FFFFFF'];
                const colorsGoldfish = [{ b: 'linear-gradient(to right, #FFD700, #ffffff)', t: '#FFD700' }, { b: 'linear-gradient(to right, #FFA500, #ffffff)', t: '#FFA500' }, { b: 'linear-gradient(to right, #FF4500, #eeeeee)', t: '#FF4500' }];

                for(let i=0; i<targetCount; i++) {
                    const type = Math.random() > 0.6 ? 'betta' : 'gold';
                    const wrapper = document.createElement('div');
                    wrapper.className = 'fish-wrapper';
                    const ratioY = (Math.random() * 0.6) - 0.25; 
                    const ratioZ = (Math.random() * 0.8 - 0.4); 
                    wrapper.style.setProperty('--ratio-y', ratioY);
                    wrapper.style.setProperty('--ratio-z', ratioZ);
                    wrapper.style.animationDuration = (15 + Math.random()*10) + 's';
                    wrapper.style.animationDelay = (Math.random()*-20) + 's';
                    let scale = 0.7 + Math.random() * 0.5;
                    wrapper.style.transform = `scale(${scale})`;

                    const model = document.createElement('div');
                    model.className = `fish-model ${type}`;
                    if(type === 'betta') {
                        let c = colorsBetta[Math.floor(Math.random() * colorsBetta.length)];
                        model.style.setProperty('--fish-color', c);
                        model.innerHTML = `<div class="fish-part body"></div><div class="fish-part tail"></div><div class="fish-part fin"></div>`;
                    } else {
                        let p = colorsGoldfish[Math.floor(Math.random() * colorsGoldfish.length)];
                        model.style.setProperty('--fish-body-grad', p.b);
                        model.style.setProperty('--fish-tail-color', p.t);
                        model.innerHTML = `<div class="fish-part body"></div><div class="fish-part tail"></div><div class="fish-part dorsal"></div><div class="fish-part pectoral left"></div><div class="fish-part pectoral right"></div>`;
                    }
                    wrapper.appendChild(model);
                    lifeContainer.appendChild(wrapper);
                }
            }

            function determineScale() {
                currentScale = window.innerWidth < 768 ? 2.8 : 6;
                updateTank();
            }
            window.addEventListener('resize', determineScale);
            [inpL, inpH, inpW].forEach(el => el.addEventListener('input', updateTank));

            // SHOP DATA CON URLS DE IMAGENES PLACEHOLDER (Reemplaza las URLs con las tuyas)
            const shopData = {
                food: [
                    { n: "Hojuelas Tetra 50g", p: 25, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Hojuelas" }, 
                    { n: "Granulado Pro 100g", p: 35, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Granulado" },
                    { n: "Artemia Seca 30g", p: 40, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Artemia" }, 
                    { n: "Pastillas Fondo", p: 30, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Pastillas" }
                ],
                filters: [
                    { n: "Canister 1200 L/H", p: 450, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Canister" }, 
                    { n: "Filtro Cascada XL", p: 85, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Cascada" },
                    { n: "Esponja Bio Doble", p: 20, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Bio+Esponja" }, 
                    { n: "Cabezal Poder 800", p: 60, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Cabezal" }
                ],
                decor: [
                    { n: "Roca Drag√≥n (Kg)", p: 15, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Roca+Dragon" }, 
                    { n: "Tronco Manglar M", p: 45, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Tronco" },
                    { n: "Cueva Cer√°mica", p: 25, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Cueva" }, 
                    { n: "Barco Hundido G", p: 55, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Barco" }
                ],
                substrates: [
                    { n: "Sustrato Nutri 3L", p: 60, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Sustrato" }, 
                    { n: "Arena S√≠lice 5Kg", p: 25, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Arena" },
                    { n: "Grava Negra 5Kg", p: 35, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Grava+Negra" }, 
                    { n: "Grava Mix 5Kg", p: 30, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Grava+Mix" }
                ]
            };

            window.loadCategory = function(cat, btn) {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const container = document.getElementById('shopCarousel');
                container.innerHTML = '';
                shopData[cat].forEach(prod => {
                    container.innerHTML += `
                        <div class="product-card">
                            <div class="p-img"><img src="${prod.i}" alt="${prod.n}"></div>
                            <div class="p-name">${prod.n}</div><div class="p-price">S/ ${prod.p.toFixed(2)}</div>
                            <button class="p-btn" onclick="addToCart('${prod.n}', ${prod.p})">A√±adir +</button>
                        </div>`;
                });
            };
            loadCategory('food', document.querySelector('.tab-btn')); // Load default

            const btnShop = document.getElementById('shopToggle');
            const contentShop = document.getElementById('shopContent');
            const arrowShop = document.getElementById('arrowIcon');
            btnShop.addEventListener('click', () => {
                contentShop.classList.toggle('open');
                arrowShop.style.transform = contentShop.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
            });

            const viewer = document.getElementById('viewer'), scene = document.getElementById('scene');
            let isDragging = false, startX, startY, rotX = -15, rotY = 35;
            const startDrag = (x, y) => { isDragging = true; startX = x; startY = y; viewer.style.cursor = 'grabbing'; };
            const stopDrag = () => { isDragging = false; viewer.style.cursor = 'grab'; };
            const moveDrag = (x, y) => {
                if(!isDragging) return;
                let dX = x - startX, dY = y - startY;
                rotY += dX * 0.3; rotX -= dY * 0.3;
                rotX = Math.max(-90, Math.min(90, rotX));
                scene.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
                startX = x; startY = y;
            };
            viewer.addEventListener('mousedown', e => startDrag(e.clientX, e.clientY));
            window.addEventListener('mouseup', stopDrag);
            window.addEventListener('mousemove', e => moveDrag(e.clientX, e.clientY));
            viewer.addEventListener('touchstart', e => startDrag(e.touches[0].clientX, e.touches[0].clientY), {passive: false});
            window.addEventListener('touchend', stopDrag);
            viewer.addEventListener('touchmove', e => { if(isDragging) e.preventDefault(); moveDrag(e.touches[0].clientX, e.touches[0].clientY); }, {passive: false});

            determineScale();
            updateTank();
        });
    </script>
</body>
</html>
