<link rel="icon" type="image/png" href="favicon.png">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALEXKIU FISH | Configurador AI</title>
    <style>
        :root {
            /* Paleta */
            --bg-deep: #020b14;
            --accent-cyan: #00FFFF;
            --accent-blue: #2979ff;
            --accent-green: #00ff9d;
            --accent-purple: #bd00ff;
            --glass-panel: rgba(10, 15, 30, 0.95);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #e0f7fa;
            
            /* Variables Geometr√≠a */
            --tank-l: 300px; --tank-h: 200px; --tank-w: 150px;
            --wood-h: 25px; --glass-lid-h: 4px;
            
            /* CAMBIO: Tecnopor m√°s delgado (10px) */
            --tecnopor-h: 10px; 
            --glass-thick: 2px;
            
            /* Materiales */
            --glass-tank-border: rgba(0, 255, 255, 0.4);
            --glass-bg: rgba(200, 255, 255, 0.03);
            --water-color: rgba(0, 255, 255, 0.08);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            height: 100vh; /* Fallback */
            width: 100vw;
            display: flex;
        }

        /* --- FONDO ANIMADO --- */
        .bg-animation {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background: radial-gradient(circle at 30% 50%, #0f2540 0%, #020b14 80%);
        }

        /* --- DECORACI√ìN DE FONDO --- */
        .holo-decoration {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 600px; height: 600px; border: 1px solid rgba(0, 255, 255, 0.05);
            border-radius: 50%; z-index: -1; pointer-events: none;
        }
        .holo-ring {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            border-radius: 50%; border: 1px dashed rgba(0, 255, 255, 0.1);
            animation: spin 60s linear infinite;
        }
        .hr-1 { width: 100%; height: 100%; animation-duration: 40s; border-color: rgba(41, 121, 255, 0.1); }
        .hr-2 { width: 70%; height: 70%; animation-duration: 25s; animation-direction: reverse; border-style: dotted; }
        .hr-3 { width: 40%; height: 40%; animation-duration: 15s; border: 2px solid rgba(0, 255, 157, 0.05); }

        @keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }

        /* --- SUELO DE REJILLA --- */
        .floor-grid {
            position: absolute; top: 60%; left: -50%; width: 200%; height: 200%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 60px 60px;
            transform: rotateX(70deg);
            z-index: -1;
            mask-image: radial-gradient(circle at 50% 0%, black 0%, transparent 50%);
            -webkit-mask-image: radial-gradient(circle at 50% 0%, black 0%, transparent 50%);
            pointer-events: none;
        }

        /* --- VISUALIZADOR 3D --- */
        .viewer-area {
            position: relative; 
            width: calc(100% - 400px); 
            height: 100%;
            z-index: 1; cursor: grab; perspective: 1800px;
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
        }
        .viewer-area:active { cursor: grabbing; }

        /* HEADER FLOTANTE */
        .floating-header {
            position: absolute; top: 30px; left: 40px; z-index: 10;
            pointer-events: none;
        }
        .brand-title {
            font-size: 4.5rem;
            font-weight: 900; line-height: 0.9; font-style: italic;
            text-transform: uppercase; letter-spacing: -2px;
            background: linear-gradient(180deg, #ffffff 0%, var(--accent-cyan) 100%);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            filter: drop-shadow(0 0 15px rgba(0, 255, 255, 0.5));
            pointer-events: auto;
        }
        .brand-subtitle { 
            font-size: 1.1rem; letter-spacing: 6px; color: var(--accent-blue); 
            margin-left: 5px; font-weight: bold; text-shadow: 0 0 10px rgba(41, 121, 255, 0.5);
        }

        /* --- HISTORIA DE MARCA (IZQUIERDA) --- */
        .brand-story {
            position: absolute; top: 160px; left: 40px; 
            width: 240px; 
            background: linear-gradient(180deg, rgba(0, 10, 20, 0.9) 0%, rgba(0,0,0,0) 100%);
            border-left: 1px solid var(--accent-cyan);
            border-right: 1px solid rgba(255,255,255,0.05);
            padding: 25px 15px;
            z-index: 5; pointer-events: none;
            display: flex; flex-direction: column; gap: 15px;
        }
        
        .bs-title {
            color: #fff; font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase;
            border-bottom: 1px solid var(--accent-blue); padding-bottom: 8px; margin-bottom: 5px;
        }

        .bs-intro { font-size: 0.85rem; color: #ccc; line-height: 1.5; font-style: italic; }

        .tech-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 12px; }
        .tech-item { display: flex; align-items: flex-start; gap: 10px; }
        .ti-icon { 
            color: var(--accent-green); font-size: 1rem; line-height: 1; margin-top: 2px;
            text-shadow: 0 0 5px var(--accent-green);
        }
        .ti-content strong { display: block; color: #fff; font-size: 0.85rem; }
        .ti-content span { display: block; color: #777; font-size: 0.75rem; line-height: 1.2; }

        /* --- LIVE DATA (DERECHA) --- */
        .live-specs {
            position: absolute; top: 160px; right: 440px; width: 240px; 
            background: linear-gradient(180deg, rgba(0, 10, 20, 0.9) 0%, rgba(0,0,0,0) 100%);
            border-right: 1px solid var(--accent-cyan); 
            border-left: 1px solid rgba(255,255,255,0.05);
            padding: 25px 15px; z-index: 5; pointer-events: none;
            display: flex; flex-direction: column; gap: 20px;
            text-align: right; align-items: flex-end;
        }

        .ls-item { display: flex; flex-direction: column; align-items: flex-end; }
        .ls-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 2px; }
        .ls-value { 
            font-family: 'Courier New', monospace; font-size: 2.2rem; font-weight: 800; color: #fff; 
            text-shadow: 0 0 10px rgba(255,255,255,0.2); line-height: 0.9;
        }
        .ls-value.highlight { color: var(--accent-cyan); text-shadow: 0 0 15px var(--accent-cyan); }
        .ls-sub { font-size: 0.75rem; color: var(--accent-green); margin-top: 4px; font-weight: bold; letter-spacing: 1px; }


        /* --- CONTROLES FLOTANTES --- */
        .controls-deck {
            position: absolute; bottom: 100px;
            display: flex; gap: 20px; z-index: 20;
            left: 50%; transform: translateX(-50%);
        }

        .control-module {
            background: rgba(10, 15, 25, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px; padding: 12px; width: 140px;
            display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            transition: 0.3s; position: relative; overflow: hidden;
        }
        .control-module:hover { border-color: var(--accent-cyan); box-shadow: 0 0 20px rgba(0,255,255,0.15); }
        
        .control-module::after {
            content:''; position: absolute; top:0; left:0; height:3px; background: var(--accent-cyan);
            width: var(--progress, 50%); transition: width 0.3s ease;
        }

        .cm-label { font-size: 0.65rem; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 5px; font-weight: 700; }
        .cm-display { 
            font-size: 2rem; font-weight: 800; color: #fff; font-family: 'Courier New', monospace; 
            margin-bottom: 8px; text-shadow: 0 0 10px rgba(0,255,255,0.2); line-height: 1;
        }
        .cm-unit { font-size: 0.8rem; color: var(--accent-cyan); margin-left: 2px;}
        
        .cm-actions { display: flex; width: 100%; justify-content: space-between; gap: 8px; }
        .cm-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff;
            flex: 1; padding: 6px 0; border-radius: 6px; cursor: pointer;
            font-weight: bold; font-size: 1.1rem; transition: 0.2s;
        }
        .cm-btn:hover { background: var(--accent-cyan); color: #000; border-color: var(--accent-cyan); }
        .cm-btn:active { transform: scale(0.95); }

        /* --- SIDEBAR DERECHO --- */
        .controls-sidebar {
            position: absolute; right: 0; top: 0; height: 100%; width: 400px;
            background: var(--glass-panel); backdrop-filter: blur(20px);
            border-left: 1px solid var(--glass-border);
            z-index: 25; display: flex; flex-direction: column;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }
        
        .sidebar-scroll {
            flex: 1; overflow-y: auto; padding: 2rem;
            scrollbar-width: thin; scrollbar-color: var(--accent-cyan) transparent;
        }

        .panel-section { margin-bottom: 2rem; }
        .panel-title { 
            font-size: 0.8rem; color: #aaa; text-transform: uppercase; 
            letter-spacing: 2px; margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 5px;
        }

        /* CARD IA RECOMENDADOR */
        .ai-card {
            background: linear-gradient(145deg, rgba(0,255,255,0.05), rgba(0,0,0,0.4));
            border: 1px solid rgba(0,255,255,0.2); border-radius: 12px;
            padding: 15px; position: relative; overflow: hidden;
        }
        .ai-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .ai-badge { background: var(--accent-cyan); color: #000; font-size: 0.6rem; font-weight: 900; padding: 2px 6px; border-radius: 3px; }
        .ai-icon { font-size: 1.5rem; text-shadow: 0 0 10px var(--accent-cyan); }
        .ai-result h4 { color: #fff; margin: 0; font-size: 1rem; }
        .ai-result p { color: #94a3b8; font-size: 0.8rem; margin: 2px 0 0 0; }
        .ai-price { color: var(--accent-green); font-weight: bold; font-size: 0.9rem; text-align: right; margin-top: 10px; }


        /* ESTILOS DE ARMADO (BOTONES) */
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
        .toggle-btn {
            flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: #aaa; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 0.8rem;
            transition: 0.3s; min-width: 80px; text-align: center;
        }
        .toggle-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .toggle-btn.active {
            background: rgba(0, 255, 255, 0.15); border-color: var(--accent-cyan);
            color: #fff; box-shadow: 0 0 10px rgba(0,255,255,0.2) inset; font-weight: bold;
        }

        /* --- BOLETA DIGITAL (RECEIPT) --- */
        .receipt-container {
            background: #000; border: 1px solid #333; border-radius: 8px;
            padding: 20px; position: relative;
            font-family: 'Courier New', monospace;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        .receipt-container::before {
            content: ''; position: absolute; top: -5px; left: 0; width: 100%; height: 5px;
            background: radial-gradient(circle, transparent 50%, #000 50%); background-size: 10px 10px;
            transform: rotate(180deg);
        }
        
        .receipt-header { text-align: center; border-bottom: 1px dashed #555; padding-bottom: 10px; margin-bottom: 15px; color: #888; font-size: 0.7rem; letter-spacing: 2px; }
        
        .receipt-row {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 8px; font-size: 0.85rem; color: #ccc;
        }
        .r-name { max-width: 60%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .r-dots { flex: 1; border-bottom: 1px dotted #444; margin: 0 5px; position: relative; top: -4px; }
        .r-price { color: #fff; }
        
        .receipt-total {
            border-top: 2px solid var(--accent-green);
            margin-top: 15px; padding-top: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .rt-label { font-size: 1rem; font-weight: bold; color: var(--accent-green); text-transform: uppercase; }
        .rt-amount { font-size: 1.4rem; font-weight: bold; color: #fff; text-shadow: 0 0 10px rgba(0, 255, 157, 0.3); }

        /* --- DELIVERY HIGHLIGHT --- */
        .delivery-highlight {
            background: linear-gradient(90deg, rgba(37, 211, 102, 0.1), transparent);
            border-left: 3px solid #25D366;
            padding: 8px 12px; margin: 15px 0 5px 0;
            display: flex; align-items: center; gap: 10px;
            font-size: 0.85rem; color: #fff; font-weight: bold;
            animation: pulse-border 3s infinite;
        }
        .dh-icon { font-size: 1.2rem; filter: drop-shadow(0 0 5px #25D366); }
        .dh-sub { display: block; font-size: 0.7rem; font-weight: normal; color: #25D366; text-transform: uppercase; letter-spacing: 1px; }

        @keyframes pulse-border {
            0% { box-shadow: -5px 0 10px -5px rgba(37, 211, 102, 0); }
            50% { box-shadow: -5px 0 15px -2px rgba(37, 211, 102, 0.4); }
            100% { box-shadow: -5px 0 10px -5px rgba(37, 211, 102, 0); }
        }

        /* --- STICKY FOOTER PARA EL BOTON DE WHATSAPP --- */
        .summary-sticky {
            background: rgba(0,0,0,0.8);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 15px;
            /* Se asegura que est√© al final del flex container */
            margin-top: auto; 
        }

        .btn-cta {
            width: 100%; background: #25D366; color: #000; border: none; padding: 14px;
            border-radius: 4px; font-weight: 800; font-size: 1.1rem; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; font-family: 'Segoe UI', sans-serif;
        }
        .btn-cta:hover { background: #1ebe57; box-shadow: 0 0 20px rgba(37, 211, 102, 0.6); color: #fff; }

        /* TIENDA DRAWER */
        .shop-drawer {
            position: fixed; bottom: 0; left: 0; 
            width: calc(100% - 400px);
            height: 75vh; z-index: 40;
            background: #0b111a; border-top: 2px solid var(--accent-cyan);
            border-radius: 20px 20px 0 0;
            transform: translateY(calc(100% - 50px));
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 -10px 50px rgba(0,0,0,0.9);
            display: flex; flex-direction: column;
        }
        .shop-drawer.open { transform: translateY(0); }

        .drawer-handle {
            height: 50px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 2rem; cursor: pointer; background: linear-gradient(to right, #050f1e, #000);
            border-radius: 18px 18px 0 0;
        }
        .drawer-title { color: #fff; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem;}
        .drawer-arrow { color: var(--accent-cyan); transition: 0.3s; }
        .shop-drawer.open .drawer-arrow { transform: rotate(180deg); }

        .shop-body { flex: 1; overflow-y: auto; padding: 2rem; opacity: 0; transition: 0.2s; }
        .shop-drawer.open .shop-body { opacity: 1; transition-delay: 0.1s; }

        /* DISE√ëO TABS: BLOQUES HUD */
        .shop-tabs { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; 
        }
        .tab-block { 
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); 
            color: #94a3b8; padding: 12px 5px; border-radius: 6px; cursor: pointer; 
            transition: 0.3s; text-align: center; font-size: 0.8rem; font-weight: bold;
            text-transform: uppercase; letter-spacing: 1px;
            position: relative; overflow: hidden;
        }
        .tab-block:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .tab-block.active { 
            background: rgba(0, 255, 255, 0.1); color: #fff; 
            border-color: var(--accent-cyan); box-shadow: 0 0 15px rgba(0,255,255,0.15);
        }
        .tab-block.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px;
            background: var(--accent-cyan); box-shadow: 0 0 10px var(--accent-cyan);
        }

        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .product-item { 
            background: #0f172a; border: 1px solid #1e293b; 
            border-radius: 10px; padding: 10px; transition: 0.2s; 
        }
        .product-item:hover { border-color: var(--accent-blue); transform: translateY(-3px); }
        .prod-img { 
            width: 100%; height: 110px; background: #020617; border-radius: 6px; margin-bottom: 8px; overflow: hidden; 
        }
        .prod-img img { width: 100%; height: 100%; object-fit: cover; }
        .prod-title { font-size: 0.85rem; color: #fff; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .prod-price { color: var(--accent-green); font-weight: bold; font-size: 0.9rem; }
        .prod-btn { 
            width: 100%; margin-top: 8px; padding: 6px; background: transparent; 
            border: 1px solid var(--accent-cyan); color: var(--accent-cyan); border-radius: 4px; 
            cursor: pointer; font-size: 0.8rem;
        }
        .prod-btn:hover { background: var(--accent-cyan); color: #000; }

        /* --- VISUALIZADOR 3D --- */
        .scene { position: relative; transform-style: preserve-3d; transform: rotateX(-15deg) rotateY(35deg); transition: transform 0.1s linear; }
        .tank { transform-style: preserve-3d; position: absolute; }
        
        .face { 
            position: absolute; background: var(--glass-bg); 
            border: var(--glass-thick) solid var(--glass-tank-border); 
            box-shadow: 0 0 40px rgba(0,255,255,0.05) inset; backface-visibility: visible; transition: all 0.4s ease; 
        }

        .f-front { width: var(--tank-l); height: var(--tank-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)); pointer-events: none; }
        .f-back  { width: var(--tank-l); height: var(--tank-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)); }
        .f-right { width: var(--tank-w); height: var(--tank-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)); }
        .f-left  { width: var(--tank-w); height: var(--tank-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)); }
        .f-bottom{ width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(-90deg) translateZ(calc(var(--tank-h) / 2)); background: rgba(0,0,0,0.95); border:1px solid #333; }
        
        .water { position: absolute; top: 0; left: 0; transform-style: preserve-3d; }
        .w-face { position: absolute; background: var(--water-color); border: none; pointer-events: none; }
        .w-front { width: calc(var(--tank-l) - 4px); height: calc(var(--tank-h) * 0.85); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2 - 2px)) translateY(calc(var(--tank-h) * 0.075)); }
        .w-back  { width: calc(var(--tank-l) - 4px); height: calc(var(--tank-h) * 0.85); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2 - 2px)) translateY(calc(var(--tank-h) * 0.075)); }
        .w-right { width: calc(var(--tank-w) - 4px); height: calc(var(--tank-h) * 0.85); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2 - 2px)) translateY(calc(var(--tank-h) * 0.075)); }
        .w-left  { width: calc(var(--tank-w) - 4px); height: calc(var(--tank-h) * 0.85); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2 - 2px)) translateY(calc(var(--tank-h) * 0.075)); }
        .w-top   { width: calc(var(--tank-l) - 4px); height: calc(var(--tank-w) - 4px); transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc((var(--tank-h) * 0.85) / 2 - (var(--tank-h) * 0.075))); background: rgba(0,255,255,0.25); box-shadow: 0 0 50px var(--accent-cyan); }

        .wood-texture { background-color: #4e342e; background-image: repeating-linear-gradient(45deg, rgba(255,255,255,0.03) 0px, rgba(255,255,255,0.03) 1px, transparent 1px, transparent 12px); border: 1px solid #3e2723; }
        .wood-group { display: none; transform-style: preserve-3d; } .wood-group.visible { display: block; }
        .wood-face { position: absolute; transition: all 0.4s ease; }
        .wl-front { width: var(--tank-l); height: var(--wood-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--wood-h) / 2) * -1 )); }
        .wl-back  { width: var(--tank-l); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--wood-h) / 2) * -1 )); }
        .wl-right { width: var(--tank-w); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--wood-h) / 2) * -1 )); }
        .wl-left  { width: var(--tank-w); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--wood-h) / 2) * -1 )); }
        .wl-top   { width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc( var(--tank-h) / 2 + var(--wood-h) )); }

        .wb-front { width: var(--tank-l); height: var(--wood-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)) translateY(calc( var(--tank-h) / 2 + var(--wood-h) / 2 )); }
        .wb-back  { width: var(--tank-l); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)) translateY(calc( var(--tank-h) / 2 + var(--wood-h) / 2 )); }
        .wb-right { width: var(--tank-w); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( var(--tank-h) / 2 + var(--wood-h) / 2 )); }
        .wb-left  { width: var(--tank-w); height: var(--wood-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( var(--tank-h) / 2 + var(--wood-h) / 2 )); }
        .wb-bottom{ width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(-90deg) translateZ(calc( var(--tank-h) / 2 + var(--wood-h) )); }
        
        /* Base Tecnopor */
        .tecnopor-face { 
            position: absolute; background-color: #2b2b2b; 
            background-image: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 3px 3px; border: 1px solid #444; 
        }
        .tecnopor-group { display: none; transform-style: preserve-3d; } .tecnopor-group.visible { display: block; }
        .wt-front { width: var(--tank-l); height: var(--tecnopor-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)) translateY(calc( var(--tank-h) / 2 + var(--tecnopor-h) / 2 )); }
        .wt-back  { width: var(--tank-l); height: var(--tecnopor-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)) translateY(calc( var(--tank-h) / 2 + var(--tecnopor-h) / 2 )); }
        .wt-right { width: var(--tank-w); height: var(--tecnopor-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( var(--tank-h) / 2 + var(--tecnopor-h) / 2 )); }
        .wt-left  { width: var(--tank-w); height: var(--tecnopor-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( var(--tank-h) / 2 + var(--tecnopor-h) / 2 )); }
        .wt-bottom{ width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(-90deg) translateZ(calc( var(--tank-h) / 2 + var(--tecnopor-h) )); }

        .glass-group { display: none; transform-style: preserve-3d; } .glass-group.visible { display: block; }
        .glass-face { position: absolute; background: rgba(10, 10, 10, 0.7); border: 1px solid rgba(255,255,255,0.15); transition: all 0.4s ease; }
        .gl-front { width: var(--tank-l); height: var(--glass-lid-h); transform: translate(-50%, -50%) translateZ(calc(var(--tank-w) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--glass-lid-h) / 2) * -1 )); }
        .gl-back  { width: var(--tank-l); height: var(--glass-lid-h); transform: translate(-50%, -50%) rotateY(180deg) translateZ(calc(var(--tank-w) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--glass-lid-h) / 2) * -1 )); }
        .gl-right { width: var(--tank-w); height: var(--glass-lid-h); transform: translate(-50%, -50%) rotateY(90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--glass-lid-h) / 2) * -1 )); }
        .gl-left  { width: var(--tank-w); height: var(--glass-lid-h); transform: translate(-50%, -50%) rotateY(-90deg) translateZ(calc(var(--tank-l) / 2)) translateY(calc( (var(--tank-h) / 2 + var(--glass-lid-h) / 2) * -1 )); }
        .gl-top   { width: var(--tank-l); height: var(--tank-w); transform: translate(-50%, -50%) rotateX(90deg) translateZ(calc( var(--tank-h) / 2 + var(--glass-lid-h) )); background: rgba(5, 5, 5, 0.85); }
        .metal-mode .face { border: 8px solid #151515; box-shadow: 0 0 0 1px #333; }

        .aquarium-content { position: absolute; top: 0; left: 0; width: 0; height: 0; transform-style: preserve-3d; pointer-events: none; }
        .fish-wrapper { position: absolute; transform-style: preserve-3d; animation: swim-path 20s linear infinite, float-y 4s ease-in-out infinite; }
        .fish-model { position: relative; transform-style: preserve-3d; }
        .fish-part { position: absolute; backface-visibility: visible; }
        .betta .body { width: 30px; height: 12px; background: var(--fish-color); border-radius: 10px; box-shadow: 0 0 8px var(--fish-color); }
        .betta .tail { width: 45px; height: 35px; background: linear-gradient(90deg, var(--fish-color), transparent); top: -10px; left: -38px; border-radius: 50% 0 0 50%; opacity: 0.9; transform-origin: right center; animation: tail-wag 0.8s ease-in-out infinite alternate; }
        .betta .fin { width: 15px; height: 10px; background: var(--fish-color); top: 8px; left: 5px; transform: rotateX(45deg); opacity: 0.7; }
        .gold .body { width: 34px; height: 24px; background: var(--fish-body-grad); border-radius: 50% 50% 40% 40%; box-shadow: inset -2px -2px 6px rgba(0,0,0,0.2); }
        .gold .tail { width: 28px; height: 32px; background: radial-gradient(circle at right, var(--fish-tail-color), transparent); position: absolute; top: -4px; left: -20px; border-radius: 50% 0 0 50%; opacity: 0.9; transform-origin: right center; animation: tail-wag 0.5s ease-in-out infinite alternate; }
        .gold .dorsal { width: 16px; height: 10px; background: var(--fish-tail-color); position: absolute; top: -8px; left: 10px; border-radius: 50% 50% 0 0; opacity: 0.8; transform: translateZ(0); }
        .gold .pectoral { width: 10px; height: 6px; background: var(--fish-tail-color); position: absolute; top: 14px; left: 18px; opacity: 0.8; animation: fin-flutter 0.2s linear infinite alternate; }
        .gold .pectoral.left { transform: translateZ(2px) rotateY(45deg); }
        .gold .pectoral.right { transform: translateZ(-2px) rotateY(-45deg); }
        @keyframes swim-path {
            0%   { transform: translateX(calc(var(--tank-l) * -0.30)) translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(0deg); }
            49%  { transform: translateX(calc(var(--tank-l) * 0.30))  translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(0deg); }
            50%  { transform: translateX(calc(var(--tank-l) * 0.30))  translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(180deg); }
            99%  { transform: translateX(calc(var(--tank-l) * -0.30)) translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(180deg); }
            100% { transform: translateX(calc(var(--tank-l) * -0.30)) translateY(calc(var(--tank-h) * var(--ratio-y))) translateZ(calc(var(--tank-w) * var(--ratio-z))) rotateY(0deg); }
        }
        @keyframes float-y { 0%, 100% { margin-top: -5px; } 50% { margin-top: 5px; } }
        @keyframes tail-wag { from { transform: rotateY(20deg); } to { transform: rotateY(-20deg); } }
        @keyframes fin-flutter { from { transform: translateZ(2px) rotateY(30deg); } to { transform: translateZ(2px) rotateY(60deg); } }

        /* RESPONSIVE (M√ìVIL MEJORADO) */
        @media (max-width: 900px) {
            body {
                flex-direction: column;
                height: 100dvh; /* Altura din√°mica para celulares */
                overflow: hidden;
            }
            .viewer-area {
                width: 100%;
                height: 40%; /* Menos altura para dar espacio a controles */
                top: 0;
            }
            .controls-sidebar {
                position: relative;
                width: 100%;
                height: 60%; /* M√°s espacio para controles */
                box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
                z-index: 30;
                display: flex; flex-direction: column;
            }
            .sidebar-scroll { flex: 1; padding-bottom: 20px; }
            
            .summary-sticky {
                position: relative; margin-top: auto; padding: 15px; 
                background: #020b14; z-index: 50;
            }

            .shop-drawer { width: 100%; height: 85vh; }
            .floating-header { top: 15px; left: 15px; }
            .brand-title { font-size: 2.2rem; } 
            
            /* Controles flotantes en m√≥vil */
            .controls-deck { bottom: 20px; width: 95%; justify-content: space-between; gap: 5px; }
            .control-module { width: 32%; padding: 5px; }
            .cm-display { font-size: 1.1rem; }
            
            .brand-story, .live-specs { display: none; } /* Ocultar paneles flotantes en m√≥vil */
            .holo-decoration { width: 280px; height: 280px; }
            .shop-tabs { display: flex; overflow-x: auto; gap: 10px; } 
            .tab-block { min-width: 100px; }
        }
    </style>
</head>
<body>

    <div class="bg-animation"></div>

    <header class="floating-header">
        <div class="brand-title">ALEXKIU <span style="color:var(--accent-blue); -webkit-text-fill-color: initial;">FISH</span></div>
        <div class="brand-subtitle">CONFIGURADOR PRO AI</div>
    </header>

    <!-- HISTORIA DE MARCA (IZQUIERDA) -->
    <div class="brand-story">
        <div class="bs-title">FILOSOF√çA DE MARCA</div>
        <div class="bs-intro">
            Dise√±amos ecosistemas inteligentes que combinan <b>precisi√≥n industrial</b> con <b>arte acu√°tico</b>.
        </div>
        
        <ul class="tech-list">
            <li class="tech-item">
                <span class="ti-icon">üëÅÔ∏è</span>
                <div class="ti-content">
                    <strong>Realidad Aumentada</strong>
                    <span>Previsualiza cada componente en tiempo real.</span>
                </div>
            </li>
            <li class="tech-item">
                <span class="ti-icon">ü§ñ</span>
                <div class="ti-content">
                    <strong>Optimizaci√≥n AI</strong>
                    <span>Algoritmos calculan el equilibrio biol√≥gico ideal.</span>
                </div>
            </li>
            <li class="tech-item">
                <span class="ti-icon">üíé</span>
                <div class="ti-content">
                    <strong>Vidrio Ultra-Clear</strong>
                    <span>Transparencia del 99% garantizada.</span>
                </div>
            </li>
            <li class="tech-item">
                <span class="ti-icon">üõ°Ô∏è</span>
                <div class="ti-content">
                    <strong>Silicona Estructural</strong>
                    <span>Sellado triple capa anti-fugas.</span>
                </div>
            </li>
            <li class="tech-item">
                <span class="ti-icon">üöö</span>
                <div class="ti-content">
                    <strong>Delivery Gratis</strong>
                    <span>A la puerta de tu casa (Todo Per√∫).</span>
                </div>
            </li>
            <li class="tech-item">
                <span class="ti-icon">‚ôªÔ∏è</span>
                <div class="ti-content">
                    <strong>Eco-Friendly</strong>
                    <span>Materiales sostenibles y duraderos.</span>
                </div>
            </li>
        </ul>
    </div>

    <!-- NUEVO: FICHA T√âCNICA VIVA (DERECHA - SIMETRICA) -->
    <div class="live-specs">
        <div class="bs-title" style="border-color:var(--accent-blue); text-align:right;">LIVE DATA</div>
        
        <div class="ls-item">
            <span class="ls-label">Volumen Neto</span>
            <span class="ls-value"><span id="liveLiters">72</span> L</span>
        </div>

        <div class="ls-item">
            <span class="ls-label">Grosor Vidrio</span>
            <span class="ls-value highlight" id="liveThickness">6mm</span>
            <span class="ls-sub">Grado Arquitect√≥nico</span>
        </div>

        <div class="ls-item">
            <span class="ls-label">Peso Estimado (Lleno)</span>
            <span class="ls-value"><span id="liveWeight">80</span> kg</span>
        </div>
    </div>

    <!-- AREA VISUALIZADOR -->
    <section class="viewer-area" id="viewer">
        
        <!-- DECORACI√ìN DE FONDO 3D -->
        <div class="holo-decoration">
            <div class="holo-ring hr-1"></div>
            <div class="holo-ring hr-2"></div>
            <div class="holo-ring hr-3"></div>
        </div>
        
        <div class="floor-grid"></div>
        
        <div class="scene" id="scene">
            <div class="tank" id="tank">
                <div class="face f-front"></div>
                <div class="face f-back"></div>
                <div class="face f-right"></div>
                <div class="face f-left"></div>
                <div class="face f-bottom"></div>
                
                <div class="wood-group" id="woodLidGroup"><div class="wood-face wood-texture wl-front"></div><div class="wood-face wood-texture wl-back"></div><div class="wood-face wood-texture wl-right"></div><div class="wood-face wood-texture wl-left"></div><div class="wood-face wood-texture wl-top"></div></div>
                <div class="glass-group" id="glassLidGroup"><div class="glass-face gl-front"></div><div class="glass-face gl-back"></div><div class="glass-face gl-right"></div><div class="glass-face gl-left"></div><div class="glass-face gl-top"></div></div>
                
                <div class="wood-group" id="woodBaseGroup"><div class="wood-face wood-texture wb-front"></div><div class="wood-face wood-texture wb-back"></div><div class="wood-face wood-texture wb-right"></div><div class="wood-face wood-texture wb-left"></div><div class="wood-face wood-texture wb-bottom"></div></div>
                <div class="tecnopor-group" id="tecnoporBaseGroup"><div class="tecnopor-face wt-front"></div><div class="tecnopor-face wt-back"></div><div class="tecnopor-face wt-right"></div><div class="tecnopor-face wt-left"></div><div class="tecnopor-face wt-bottom"></div></div>

                <div class="aquarium-content" id="lifeContainer"></div>
                <div class="water"><div class="w-face w-front"></div><div class="w-face w-back"></div><div class="w-face w-right"></div><div class="w-face w-left"></div><div class="w-face w-top"></div></div>
            </div>
        </div>

        <!-- MODULOS DE CONTROL FLOTANTES -->
        <div class="controls-deck">
            <!-- Modulo Largo -->
            <div class="control-module" id="modL">
                <span class="cm-label">Largo</span>
                <span class="cm-display"><span id="valL">60</span><span class="cm-unit">cm</span></span>
                <div class="cm-actions">
                    <button class="cm-btn" onclick="adjustDim('L', -5)">-</button>
                    <button class="cm-btn" onclick="adjustDim('L', 5)">+</button>
                </div>
            </div>
            <!-- Modulo Alto -->
            <div class="control-module" id="modH">
                <span class="cm-label">Alto</span>
                <span class="cm-display"><span id="valH">40</span><span class="cm-unit">cm</span></span>
                <div class="cm-actions">
                    <button class="cm-btn" onclick="adjustDim('H', -5)">-</button>
                    <button class="cm-btn" onclick="adjustDim('H', 5)">+</button>
                </div>
            </div>
            <!-- Modulo Fondo -->
            <div class="control-module" id="modW">
                <span class="cm-label">Fondo</span>
                <span class="cm-display"><span id="valW">30</span><span class="cm-unit">cm</span></span>
                <div class="cm-actions">
                    <button class="cm-btn" onclick="adjustDim('W', -5)">-</button>
                    <button class="cm-btn" onclick="adjustDim('W', 5)">+</button>
                </div>
            </div>
        </div>

    </section>

    <!-- SIDEBAR DERECHO -->
    <aside class="controls-sidebar">
        <div class="sidebar-scroll">
            
            <!-- SECCION: IA FILTER CORE -->
            <div class="panel-section">
                <div class="panel-title">üß† AN√ÅLISIS DE ECOSISTEMA</div>
                <div class="ai-card">
                    <div class="ai-header">
                        <span class="ai-badge">AI CORE</span>
                        <div class="ai-icon">‚öôÔ∏è</div>
                    </div>
                    <div class="ai-result">
                        <span style="font-size:0.7rem; color:#aaa;">FILTRACI√ìN SUGERIDA:</span>
                        <h4 id="recTitle">Calculando...</h4>
                        <p id="recDesc">Analizando volumen...</p>
                        <div class="ai-price" id="filterPriceDisplay">S/ 0</div>
                    </div>
                    <button class="btn-cta" style="background:transparent; border:1px solid var(--accent-cyan); color:var(--accent-cyan); padding:5px; margin-top:10px; font-size:0.7rem;" id="btnFilterToggle" onclick="toggleFilter()">AGREGAR AL PEDIDO</button>
                </div>
            </div>

            <!-- PERSONALIZACION -->
            <div class="panel-section">
                <div class="panel-title">üõ†Ô∏è PERSONALIZACI√ìN</div>
                
                <div style="font-size:0.8rem; color:#888; margin-bottom:5px;">ACABADO</div>
                <div class="btn-group" id="finish-options">
                    <div class="toggle-btn active" onclick="setFinish('rimless', this)">Sin Marco</div>
                    <div class="toggle-btn" onclick="setFinish('metal', this)">Aluminio</div>
                </div>
                
                <div style="font-size:0.8rem; color:#888; margin-bottom:5px;">TAPA</div>
                <div class="btn-group" id="lid-options">
                    <div class="toggle-btn active" onclick="setLid('none', this)">Sin Tapa</div>
                    <div class="toggle-btn" onclick="setLid('glass', this)">Vidrio</div>
                    <div class="toggle-btn" onclick="setLid('wood', this)">Madera</div>
                </div>

                <div style="font-size:0.8rem; color:#888; margin-bottom:5px;">BASE</div>
                <div class="btn-group" id="base-options">
                    <div class="toggle-btn" onclick="setBase('none', this)">Sin Base</div>
                    <div class="toggle-btn active" onclick="setBase('tecnopor', this)">Tecnopor</div>
                    <div class="toggle-btn" onclick="setBase('wood', this)">Madera</div>
                </div>
            </div>

            <!-- BOLETA DIGITAL -->
            <div class="panel-section">
                <div class="panel-title">üßæ DETALLE DE COSTOS</div>
                <div class="receipt-container">
                    <div class="receipt-header">
                        ALEXKIU FISH // COTIZACI√ìN #<span id="rndId">001</span><br>
                        <span id="dateDisplay">--/--/--</span>
                    </div>
                    
                    <div id="receiptBody">
                        <!-- Items inyectados por JS -->
                    </div>

                    <!-- DELIVERY GRATIS BADGE -->
                    <div class="delivery-highlight">
                        <span class="dh-icon">üöö</span>
                        <div>
                            DELIVERY GRATIS
                            <span class="dh-sub">A LA PUERTA DE TU CASA</span>
                        </div>
                    </div>

                    <div class="receipt-total">
                        <span class="rt-label">TOTAL</span>
                        <span class="rt-amount" id="totalPrice">S/ 0.00</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- STICKY FOOTER PARA EL BOTON -->
        <div class="summary-sticky">
            <button class="btn-cta" onclick="sendToWhatsapp()">CONFIRMAR PEDIDO</button>
        </div>
    </aside>

    <!-- TIENDA DRAWER -->
    <div class="shop-drawer" id="shopDrawer">
        <div class="drawer-handle" id="drawerHandle">
            <span class="drawer-title">üõí Agregar Accesorios</span>
            <span class="drawer-arrow">‚ñ≤</span>
        </div>
        <div class="shop-body">
            
            <!-- NUEVO DISE√ëO TABS: BLOQUES HUD -->
            <div class="shop-tabs">
                <div class="tab-block active" onclick="loadCategory('food', this)">ALIMENTOS</div>
                <div class="tab-block" onclick="loadCategory('filters', this)">FILTROS</div>
                <div class="tab-block" onclick="loadCategory('decor', this)">DECORACI√ìN</div>
                <div class="tab-block" onclick="loadCategory('substrates', this)">SUSTRATOS</div>
            </div>

            <div class="products-grid" id="shopCarousel"></div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let currentScale = 6;
            let currentFinish = 'rimless';
            let currentLid = 'none';
            let currentBase = 'tecnopor'; 
            let cart = [];
            let currentTotal = 0;
            let isFilterIncluded = false; 

            // Datos actuales de dimensiones (INICIALES 60x40x30)
            let dimL = 60, dimH = 40, dimW = 30;

            // Date & ID
            document.getElementById('dateDisplay').innerText = new Date().toLocaleDateString();
            document.getElementById('rndId').innerText = Math.floor(Math.random() * 9000 + 1000);

            // DOM Elements
            const root = document.documentElement;
            const valL = document.getElementById('valL'), valH = document.getElementById('valH'), valW = document.getElementById('valW');
            const modL = document.getElementById('modL'), modH = document.getElementById('modH'), modW = document.getElementById('modW');
            const liveLiters = document.getElementById('liveLiters'), liveThickness = document.getElementById('liveThickness'), liveWeight = document.getElementById('liveWeight');
            
            const tankEl = document.getElementById('tank');
            const woodLidGroup = document.getElementById('woodLidGroup'), glassLidGroup = document.getElementById('glassLidGroup');
            const woodBaseGroup = document.getElementById('woodBaseGroup'), tecnoporBaseGroup = document.getElementById('tecnoporBaseGroup');
            
            const recTitle = document.getElementById('recTitle'), recDesc = document.getElementById('recDesc'), filterPriceDisplay = document.getElementById('filterPriceDisplay'), btnFilterToggle = document.getElementById('btnFilterToggle');
            const receiptBody = document.getElementById('receiptBody'), totalPriceEl = document.getElementById('totalPrice');
            const lifeContainer = document.getElementById('lifeContainer');

            // --- FUNCTION TO ADJUST DIMENSIONS VIA BUTTONS ---
            window.adjustDim = function(axis, amount) {
                if (axis === 'L') {
                    dimL += amount;
                    if(dimL < 30) dimL = 30; if(dimL > 300) dimL = 300;
                } else if (axis === 'H') {
                    dimH += amount;
                    if(dimH < 20) dimH = 20; if(dimH > 150) dimH = 150;
                } else if (axis === 'W') {
                    dimW += amount;
                    if(dimW < 20) dimW = 20; if(dimW > 100) dimW = 100;
                }
                updateTank();
            };

            // Update Progress Bars on Modules
            function updateModuleProgress(mod, val, min, max) {
                let pct = ((val - min) / (max - min)) * 100;
                mod.style.setProperty('--progress', pct + '%');
            }

            // Global Functions
            window.setFinish = function(val, btn) {
                document.querySelectorAll('#finish-options .toggle-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFinish = val; updateTank();
            }
            window.setLid = function(val, btn) {
                document.querySelectorAll('#lid-options .toggle-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentLid = val; updateTank();
            }
            window.setBase = function(val, btn) {
                document.querySelectorAll('#base-options .toggle-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentBase = val; updateTank();
            }

            window.toggleFilter = function() {
                isFilterIncluded = !isFilterIncluded;
                if(isFilterIncluded) {
                    btnFilterToggle.innerText = "QUITAR";
                    btnFilterToggle.style.borderColor = "#ff4444";
                    btnFilterToggle.style.color = "#ff4444";
                } else {
                    btnFilterToggle.innerText = "AGREGAR AL PEDIDO";
                    btnFilterToggle.style.borderColor = "var(--accent-cyan)";
                    btnFilterToggle.style.color = "var(--accent-cyan)";
                }
                updateTank();
            }

            window.addToCart = function(n, p) { 
                cart.push({name:n, price:p}); updateTank(); 
                document.getElementById('shopDrawer').classList.remove('open');
            };
            
            window.removeFromCart = function(i) { 
                cart.splice(i, 1); updateTank(); 
            };

            // --- CALCULADORA DE PRECIO BASE INTELIGENTE ---
            function getBasePrice(vol) {
                // L√≥gica derivada de la lista de precios de imagen
                if (vol <= 10) return 30;
                if (vol <= 40) return 20 + vol; // 10L=30, 20L=40, 30L=50, 40L=60
                if (vol <= 50) return 60 + ((vol - 40) * 2); // 40L=60, 50L=80 (Salto 20)
                if (vol <= 60) return 80 + ((vol - 50) * 5); // 50L=80, 60L=130 (Salto grande 50)
                if (vol <= 100) return 130 + ((vol - 60) * 2.5); // 60L=130, 80L=180, 100L=230
                if (vol <= 250) return 230 + (vol - 100); // 100L=230, 150L=280, 200L=330, 250L=380
                return 380 + ((vol - 250) * 1.2); // Proyecci√≥n para > 250L
            }

            // --- CALCULADORA PRECIO TAPA VIDRIO ---
            function getGlassLidPrice(vol) {
                if (vol <= 40) return 10;
                if (vol <= 80) return 20;
                if (vol <= 150) return 30;
                return 40;
            }

            window.updateTank = function() {
                // Update HUD displays
                valL.innerText = dimL; valH.innerText = dimH; valW.innerText = dimW;
                updateModuleProgress(modL, dimL, 30, 300);
                updateModuleProgress(modH, dimH, 20, 150);
                updateModuleProgress(modW, dimW, 20, 100);

                let volume = (dimL * dimH * dimW) / 1000;
                liveLiters.innerText = Math.round(volume);
                liveWeight.innerText = Math.round(volume + (volume * 0.1)); // Approx weight + glass

                // Grosor L√≥gica
                let thickPx = 2;
                let thicknessText = "4mm";

                if(volume <= 60) { thicknessText = "4mm"; thickPx = 2; }
                else if(volume <= 100) { thicknessText = "6mm"; thickPx = 4; }
                else if(volume <= 150) { thicknessText = "8mm"; thickPx = 6; }
                else { thicknessText = "10mm"; thickPx = 8; }
                
                liveThickness.innerText = thicknessText;
                root.style.setProperty('--glass-thick', thickPx + 'px');

                // 3D Transforms
                root.style.setProperty('--tank-l', (dimL * currentScale) + 'px');
                root.style.setProperty('--tank-h', (dimH * currentScale) + 'px');
                root.style.setProperty('--tank-w', (dimW * currentScale) + 'px');

                // Visibility
                woodLidGroup.classList.remove('visible');
                glassLidGroup.classList.remove('visible');
                woodBaseGroup.classList.remove('visible');
                tecnoporBaseGroup.classList.remove('visible');

                if(currentLid === 'wood') woodLidGroup.classList.add('visible');
                if(currentLid === 'glass') glassLidGroup.classList.add('visible');
                if(currentBase === 'wood') woodBaseGroup.classList.add('visible');
                if(currentBase === 'tecnopor') tecnoporBaseGroup.classList.add('visible');

                tankEl.classList.toggle('metal-mode', currentFinish === 'metal');

                // AI Recommender
                let filterData = getFilterData(volume);
                recTitle.innerText = filterData.name;
                recDesc.innerText = filterData.desc;
                filterPriceDisplay.innerText = "S/ " + filterData.price.toFixed(2);

                calculateReceipt(volume, thicknessText, filterData);
                generateLife(volume);
            };

            function getFilterData(vol) {
                if (vol < 40) return { name: "Filtro Cascada Mini", price: 45, desc: "Flujo Suave" };
                if (vol < 100) return { name: "Filtro Cascada Med", price: 85, desc: "Flujo Medio" };
                if (vol < 250) return { name: "Canister Externo", price: 380, desc: "Alto Rendimiento" };
                return { name: "Sump Profesional", price: 650, desc: "Filtraci√≥n Industrial" };
            }

            function calculateReceipt(liters, thicknessText, filterData) {
                // Nuevo c√°lculo de precio base usando la funci√≥n inteligente
                let basePrice = getBasePrice(liters);

                let items = [];
                items.push({ n: `Pecera ${liters.toFixed(0)}L (${thicknessText})`, p: basePrice });
                
                if (currentFinish === 'metal') items.push({ n: "Marco Aluminio", p: 100 });
                if (currentLid === 'wood') items.push({ n: "Tapa Madera", p: 115 });
                if (currentLid === 'glass') items.push({ n: "Tapa Vidrio", p: getGlassLidPrice(liters) });
                if (currentBase === 'wood') items.push({ n: "Base Madera", p: 115 });
                if (currentBase === 'tecnopor') items.push({ n: "Base Tecnopor", p: 0 }); // S/ 0 (Gratis)
                
                if (isFilterIncluded) items.push({ n: filterData.name, p: filterData.price });

                cart.forEach((c, i) => items.push({ n: c.name, p: c.price, idx: i }));

                // Render Receipt
                let html = '';
                let total = 0;
                items.forEach(item => {
                    total += item.p;
                    let deleteBtn = item.idx !== undefined ? `<span style="color:#f44; cursor:pointer;" onclick="removeFromCart(${item.idx})">[x]</span>` : '';
                    html += `
                        <div class="receipt-row">
                            <span class="r-name">${item.n}</span>
                            <span class="r-dots"></span>
                            <span class="r-price">S/ ${item.p.toFixed(2)} ${deleteBtn}</span>
                        </div>
                    `;
                });
                receiptBody.innerHTML = html;
                currentTotal = total;
                totalPriceEl.innerText = "S/ " + total.toFixed(2);
            }

            window.sendToWhatsapp = function() {
                let msg = `*PEDIDO ALEXKIU FISH*\n------------------\n`;
                // Simple parsing of receipt text for whatsapp
                let rows = document.querySelectorAll('.receipt-row');
                rows.forEach(r => {
                    let name = r.querySelector('.r-name').innerText;
                    let price = r.querySelector('.r-price').innerText.replace('[x]', '');
                    msg += `${name}: ${price}\n`;
                });
                msg += `------------------\n*TOTAL: S/ ${currentTotal.toFixed(2)}*`;
                window.open(`https://wa.me/51908761978?text=${encodeURIComponent(msg)}`, '_blank');
            };

            function generateLife(liters) {
                let targetCount = liters < 60 ? 2 : (liters <= 150 ? 5 : 8); 
                if (lifeContainer.childElementCount === targetCount) return;
                lifeContainer.innerHTML = '';
                for(let i=0; i<targetCount; i++) {
                    const type = Math.random() > 0.6 ? 'betta' : 'gold';
                    const wrapper = document.createElement('div');
                    wrapper.className = 'fish-wrapper';
                    wrapper.style.setProperty('--ratio-y', (Math.random() * 0.6) - 0.25);
                    wrapper.style.setProperty('--ratio-z', (Math.random() * 0.8 - 0.4));
                    wrapper.style.animationDuration = (15 + Math.random()*10) + 's';
                    wrapper.style.animationDelay = (Math.random()*-20) + 's';
                    wrapper.style.transform = `scale(${0.7 + Math.random() * 0.5})`;
                    const model = document.createElement('div');
                    model.className = `fish-model ${type}`;
                    if(type==='betta') {
                        model.style.setProperty('--fish-color', ['#00FFFF', '#FF0000', '#FFFFFF'][Math.floor(Math.random()*3)]);
                        model.innerHTML = `<div class="fish-part body"></div><div class="fish-part tail"></div><div class="fish-part fin"></div>`;
                    } else {
                        model.style.setProperty('--fish-body-grad', 'linear-gradient(to right, #FFD700, #ffffff)');
                        model.style.setProperty('--fish-tail-color', '#FFD700');
                        model.innerHTML = `<div class="fish-part body"></div><div class="fish-part tail"></div><div class="fish-part dorsal"></div><div class="fish-part pectoral left"></div><div class="fish-part pectoral right"></div>`;
                    }
                    wrapper.appendChild(model);
                    lifeContainer.appendChild(wrapper);
                }
            }

            function determineScale() {
                currentScale = window.innerWidth < 900 ? 2.5 : 5.5;
                updateTank();
            }
            window.addEventListener('resize', determineScale);

            // Shop Data Expanded
            const shopData = {
                food: [
                    { n: "Hojuelas Tetra 50g", p: 25, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Hojuelas" }, 
                    { n: "Granulado Pro 100g", p: 35, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Granulado" },
                    { n: "Artemia Seca 30g", p: 40, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Artemia" },
                    { n: "Pastillas Fondo 50g", p: 30, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Pastillas" },
                    { n: "Alimento Betta 10g", p: 15, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Betta" },
                    { n: "Espirulina Pura 20g", p: 45, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Espirulina" }
                ],
                filters: [
                    { n: "Canister 1200 L/H", p: 450, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Canister" }, 
                    { n: "Filtro Cascada XL", p: 85, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Cascada+XL" },
                    { n: "Filtro Interno 600", p: 45, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Interno" },
                    { n: "Esponja Bio Doble", p: 25, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=BioEsponja" },
                    { n: "Skimmer Superficie", p: 60, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Skimmer" },
                    { n: "Bomba Aire Doble", p: 55, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Oxigeno" }
                ],
                decor: [
                    { n: "Roca Drag√≥n (Kg)", p: 15, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Roca+Dragon" }, 
                    { n: "Tronco Manglar M", p: 45, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Tronco" },
                    { n: "Cueva Cer√°mica", p: 25, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Cueva" },
                    { n: "Barco Hundido", p: 55, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Barco" },
                    { n: "Bonsai Artificial", p: 65, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Bonsai" },
                    { n: "Set Piedras Seiryu", p: 80, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Seiryu" }
                ],
                substrates: [
                    { n: "Sustrato Nutri 3L", p: 60, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Sustrato" }, 
                    { n: "Arena S√≠lice 5Kg", p: 25, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Arena+Silice" },
                    { n: "Grava Negra 5Kg", p: 35, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Grava+Negra" },
                    { n: "Arena Blanca 5Kg", p: 30, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Arena+Blanca" },
                    { n: "Grava Volc√°nica", p: 40, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Volcanica" },
                    { n: "Manado JBL 3L", p: 75, i: "https://via.placeholder.com/160x120/0f2035/00FFFF?text=Manado" }
                ]
            };

            window.loadCategory = function(cat, btn) {
                document.querySelectorAll('.tab-block').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const container = document.getElementById('shopCarousel');
                container.innerHTML = '';
                shopData[cat].forEach(prod => {
                    container.innerHTML += `
                        <div class="product-item">
                            <div class="prod-img"><img src="${prod.i}" alt="${prod.n}"></div>
                            <div class="prod-title">${prod.n}</div>
                            <div class="prod-price">S/ ${prod.p.toFixed(2)}</div>
                            <button class="prod-btn" onclick="addToCart('${prod.n}', ${prod.p})">Agregar</button>
                        </div>`;
                });
            };
            loadCategory('food', document.querySelector('.tab-block'));

            // Drawer
            const drawer = document.getElementById('shopDrawer');
            const handle = document.getElementById('drawerHandle');
            handle.addEventListener('click', () => {
                drawer.classList.toggle('open');
            });

            // 3D Rotation
            const viewer = document.getElementById('viewer'), scene = document.getElementById('scene');
            let isDragging = false, startX, startY, rotX = -15, rotY = 35;
            const startDrag = (x, y) => { isDragging = true; startX = x; startY = y; viewer.style.cursor = 'grabbing'; };
            const stopDrag = () => { isDragging = false; viewer.style.cursor = 'grab'; };
            const moveDrag = (x, y) => {
                if(!isDragging) return;
                let dX = x - startX, dY = y - startY;
                rotY += dX * 0.3; rotX -= dY * 0.3;
                rotX = Math.max(-90, Math.min(90, rotX));
                scene.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
                startX = x; startY = y;
            };
            viewer.addEventListener('mousedown', e => startDrag(e.clientX, e.clientY));
            window.addEventListener('mouseup', stopDrag);
            window.addEventListener('mousemove', e => moveDrag(e.clientX, e.clientY));
            viewer.addEventListener('touchstart', e => startDrag(e.touches[0].clientX, e.touches[0].clientY), {passive: false});
            window.addEventListener('touchend', stopDrag);
            viewer.addEventListener('touchmove', e => { if(isDragging) e.preventDefault(); moveDrag(e.touches[0].clientX, e.touches[0].clientY); }, {passive: false});

            determineScale();
            updateTank();
        });
    </script>
</body>
</html>
